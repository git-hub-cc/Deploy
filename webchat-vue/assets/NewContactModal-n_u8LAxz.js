import{_ as H,a as Q,D as X,u as Y,c as Z,E as ee,r,w as te,g as oe,h as i,i as V,j as t,l as d,m,n as I,v as y,x as f,k as ae,p as j,F as ne,s as se,t as x,T as le,A as p,G as B}from"./index-dUS5mm6e.js";import{M as re}from"./ModalWrapper-DMihTpK2.js";const ie={class:"interaction-manager"},ue={class:"modal-tabs"},ce={key:0,class:"tab-content"},de={key:1,class:"tab-content"},me={key:2,class:"tab-content"},pe={key:3,class:"tab-content"},ve={class:"memory-set-list"},ye={key:0,class:"empty-list-info"},fe={class:"set-name"},ge={class:"set-actions"},be=["onClick"],we=["onClick"],Ce={key:0,class:"memory-set-form"},he={class:"form-actions"},ke={__name:"NewContactModal",emits:["close"],setup(Se,{emit:L}){const N=L,R=Q(),O=X(),U=Y(),D=Z(),g=ee(),n=r("contact"),b=r(""),k=r(""),S=r(""),$=r(""),E=r(null),w=r(!1),v=r(null),C=r(""),h=r("");te(()=>D.modalPrefillData,o=>{o.prefillId&&(b.value=o.prefillId,k.value=o.prefillName||"",n.value="contact")},{immediate:!0});const _=async()=>{if(!b.value){p.emit("showNotification",{message:"å¯¹æ–¹IDä¸èƒ½ä¸ºç©º",type:"warning"});return}await R.addContact({id:b.value,name:k.value,type:"contact"})&&N("close")},A=async()=>{if(!S.value){p.emit("showNotification",{message:"ç¾¤ç»„åç§°ä¸èƒ½ä¸ºç©º",type:"warning"});return}await O.createGroup(S.value,$.value)&&N("close")},G=()=>{var o;return(o=E.value)==null?void 0:o.click()},J=o=>{const e=o.target.files[0];if(!e)return;const a=new FileReader;a.onload=async u=>{try{const l=JSON.parse(u.target.result);if(!Array.isArray(l))throw new Error("JSONæ–‡ä»¶å†…å®¹ä¸æ˜¯æ•°ç»„ã€‚");for(const s of l)await R.addContact({...s,isImported:!0});p.emit("showNotification",{message:`æˆåŠŸå¯¼å…¥ ${l.length} ä¸ªè§’è‰²ã€‚`,type:"success"}),N("close")}catch(l){p.emit("showNotification",{message:`å¯¼å…¥å¤±è´¥: ${l.message}`,type:"error"})}},a.readAsText(e),o.target&&(o.target.value="")},P=async o=>{if(!o)return null;try{const e=await fetch(o);if(!e.ok)throw new Error(`Image fetch failed: ${e.statusText}`);const a=await e.blob();return new Promise((u,l)=>{const s=new FileReader;s.onloadend=()=>u(s.result),s.onerror=l,s.readAsDataURL(a)})}catch(e){return B(`Failed to convert image to Base64 (URL: ${o}): ${e}`,"ERROR"),null}},W=async()=>{await U.ensureThemeDataIsLoaded();const o=U.currentSpecialContacts;if(!o||o.length===0){p.emit("showNotification",{message:"å½“å‰ä¸»é¢˜æ²¡æœ‰å¯å¯¼å‡ºçš„è§’è‰²ã€‚",type:"info"});return}p.emit("showNotification",{message:"æ­£åœ¨å‡†å¤‡è§’è‰²æ•°æ®...",type:"info"});try{const e=await Promise.all(o.map(async q=>{const c={...q};if(delete c.lastMessage,delete c.lastTime,delete c.unread,delete c.isOnline,c.avatarUrl){const F=await P(c.avatarUrl);F&&(c.avatarDataUrl=F),delete c.avatarUrl}return c})),a=JSON.stringify(e,null,2),u=new Blob([a],{type:"application/json"}),l=URL.createObjectURL(u),s=document.createElement("a");s.href=l,s.download=`WebChat_Theme_${U.currentThemeKey}_Characters.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}catch(e){p.emit("showNotification",{message:"å¯¼å‡ºè§’è‰²å¤±è´¥ï¼Œè¯·æ£€æŸ¥æŽ§åˆ¶å°ã€‚",type:"error"}),B(`Error exporting characters: ${e}`,"ERROR")}},M=(o=null)=>{o?(v.value=o.id,C.value=o.name,h.value=o.elements.join(", ")):(v.value=null,C.value="",h.value=""),w.value=!0},T=()=>{w.value=!1},z=async()=>{const o=C.value.trim(),e=h.value.split(/[,ï¼Œã€\s]+/).map(u=>u.trim()).filter(Boolean);(v.value?await g.updateElementSet(v.value,o,e):await g.addElementSet(o,e))&&T()},K=o=>{D.showConfirmationModal({message:`ç¡®å®šè¦åˆ é™¤è®°å¿†ä¹¦ "${o.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ã€‚`,onConfirm:()=>g.deleteElementSet(o.id)})};return(o,e)=>(i(),oe(re,{show:!0,title:"äº¤äº’ç®¡ç†",onClose:e[11]||(e[11]=a=>o.$emit("close"))},{default:V(()=>[t("div",ie,[t("nav",ue,[t("button",{class:I({active:n.value==="contact"}),onClick:e[0]||(e[0]=a=>n.value="contact")},"è”ç³»äºº",2),t("button",{class:I({active:n.value==="group"}),onClick:e[1]||(e[1]=a=>n.value="group")},"ç¾¤ç»„",2),t("button",{class:I({active:n.value==="character"}),onClick:e[2]||(e[2]=a=>n.value="character")},"è§’è‰²",2),t("button",{class:I({active:n.value==="memory"}),onClick:e[3]||(e[3]=a=>n.value="memory")},"è®°å¿†ä¹¦",2)]),n.value==="contact"?(i(),d("div",ce,[e[12]||(e[12]=t("h3",null,"æ·»åŠ /ä¿®æ”¹è”ç³»äºº",-1)),e[13]||(e[13]=t("p",null,"è¾“å…¥å¯¹æ–¹IDã€‚è‹¥IDå·²å­˜åœ¨ï¼Œå¯ä¿®æ”¹å…¶æ˜µç§°ã€‚",-1)),y(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),placeholder:"å¯¹æ–¹ ID (å¿…å¡«)"},null,512),[[f,b.value]]),y(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>k.value=a),placeholder:"å¯¹æ–¹æ˜µç§° (å¯é€‰)"},null,512),[[f,k.value]]),t("button",{class:"btn-primary",onClick:_},"ç¡®è®¤")])):m("",!0),n.value==="group"?(i(),d("div",de,[e[14]||(e[14]=t("h3",null,"åˆ›å»º/ä¿®æ”¹ç¾¤ç»„",-1)),e[15]||(e[15]=t("p",null,"è¾“å…¥ç¾¤ç»„åç§°ã€‚æä¾›IDå¯ä¿®æ”¹ï¼Œç•™ç©ºåˆ™åˆ›å»ºã€‚",-1)),y(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=a=>S.value=a),placeholder:"ç¾¤ç»„åç§° (å¿…å¡«)"},null,512),[[f,S.value]]),y(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=a=>$.value=a),placeholder:"ç¾¤ç»„ ID (å¯é€‰)"},null,512),[[f,$.value]]),t("button",{class:"btn-primary",onClick:A},"ç¡®è®¤")])):m("",!0),n.value==="character"?(i(),d("div",me,[e[16]||(e[16]=t("h3",null,"è§’è‰²å¡ç®¡ç†",-1)),e[17]||(e[17]=t("p",null,"å¯¼å…¥æˆ–å¯¼å‡ºè§’è‰²å®šä¹‰æ–‡ä»¶ (.json)ã€‚",-1)),t("div",{class:"button-group"},[t("button",{class:"btn-secondary",onClick:G},"å¯¼å…¥è§’è‰²å¡"),t("button",{class:"btn-secondary",onClick:W},"å¯¼å‡ºå½“å‰ä¸»é¢˜è§’è‰²")]),t("input",{type:"file",ref_key:"importFileInputRef",ref:E,onChange:J,accept:".json",style:{display:"none"}},null,544)])):m("",!0),n.value==="memory"?(i(),d("div",pe,[e[18]||(e[18]=t("h3",null,"è®°å¿†ä¹¦ç®¡ç†",-1)),e[19]||(e[19]=t("p",null,"ç®¡ç†ç”¨äºŽAIæå–é•¿æœŸè®°å¿†çš„å…³é”®è¦ç´ ã€‚",-1)),t("div",ve,[j(g).elementSets.length===0&&!w.value?(i(),d("div",ye," è¿˜æ²¡æœ‰è®°å¿†ä¹¦ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ä¸€ä¸ªå§ï¼ ")):m("",!0),(i(!0),d(ne,null,se(j(g).elementSets,a=>(i(),d("div",{key:a.id,class:"memory-set-item"},[t("span",fe,x(a.name),1),t("div",ge,[t("button",{class:"btn-icon",onClick:u=>M(a),title:"ç¼–è¾‘"},"âœï¸",8,be),t("button",{class:"btn-icon",onClick:u=>K(a),title:"åˆ é™¤"},"ðŸ—‘ï¸",8,we)])]))),128))]),ae(le,{name:"form-fade"},{default:V(()=>[w.value?(i(),d("div",Ce,[t("h4",null,x(v.value?"ç¼–è¾‘è®°å¿†ä¹¦":"æ·»åŠ æ–°è®°å¿†ä¹¦"),1),y(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=a=>C.value=a),placeholder:"è®°å¿†ä¹¦åç§° (ä¾‹å¦‚: 'ä¸ªäººå–œå¥½')"},null,512),[[f,C.value]]),y(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=a=>h.value=a),placeholder:"å…³é”®è¦ç´ , ç”¨é€—å·åˆ†éš” (ä¾‹å¦‚: 'é¢œè‰², é£Ÿç‰©')"},null,512),[[f,h.value]]),t("div",he,[t("button",{class:"btn-secondary",onClick:T},"å–æ¶ˆ"),t("button",{class:"btn-primary",onClick:z},x(v.value?"ä¿å­˜ä¿®æ”¹":"ç¡®è®¤æ·»åŠ "),1)])])):m("",!0)]),_:1}),w.value?m("",!0):(i(),d("button",{key:0,class:"btn-primary",onClick:e[10]||(e[10]=a=>M())},"+ æ·»åŠ æ–°è®°å¿†ä¹¦"))])):m("",!0)])]),_:1}))}},Ue=H(ke,[["__scopeId","data-v-b9d75849"]]);export{Ue as default};
