import{_ as F,a as E,d as M,r as U,w as S,a8 as k,e as L,W as g,G as j,H as N,o as R,l as a,h as l,j as _,F as y,s as v,v as r,t as d,y as x,R as B,m as V,x as G,a9 as q,aa as A}from"./index-dUS5mm6e.js";const H={class:"tts-settings-form"},W=["for"],z=["id"],J=["value"],K=["id"],Q=["value"],X=["placeholder","disabled"],Y={key:0,class:"options-container"},Z=["onMousedown"],ee={key:0,class:"option-disabled"},te=["onUpdate:modelValue","disabled"],oe={disabled:"",value:""},ne=["value"],se=["onUpdate:modelValue","id"],ae=["onUpdate:modelValue","id"],le=["value"],ie=["type","onUpdate:modelValue","id","step","min","max"],ce={__name:"TtsSettings",props:{contactId:{type:String,required:!0}},setup(c){const b=c,h=E(),D=[{key:"tts_mode",label:"模式",type:"select",default:"Dynamic",options:[{value:"Preset",text:"预设"},{value:"Dynamic",text:"动态"}]},{key:"version",label:"版本",type:"select",default:"v4",options:[{value:"v2",text:"v2"},{value:"v3",text:"v3"},{value:"v4",text:"v4"}]},{key:"enabled",label:"启用TTS",type:"checkbox",default:!1},{key:"model_name",label:"模型",type:"text",default:"",isPotentiallyDynamic:!0},{key:"prompt_text_lang",label:"参考音频语言",type:"select",options:[],isPotentiallyDynamic:!0},{key:"emotion",label:"情感",type:"select",options:[],isPotentiallyDynamic:!0},{key:"text_lang",label:"文本语言",type:"select",options:["中文","英语","日语","粤语","韩语","中英混合","日英混合","粤英混合","韩英混合","多语种混合","多语种混合（粤语）"]},{key:"text_split_method",label:"切分方法",type:"select",options:["四句一切","凑50字一切","按中文句号。切","按英文句号.切","按标点符号切"]},{key:"seed",label:"种子",type:"number",default:-1,step:1}],n=M({}),u=M({models:"idle"}),i=U(""),p=U(!1);S(()=>b.contactId,s=>{var o;if(s){const e=h.contacts[s],t={...k,...((o=e==null?void 0:e.aiConfig)==null?void 0:o.tts)||{}};Object.assign(n,t),n.tts_mode==="Dynamic"&&(i.value=n.model_name,f(n.version))}},{immediate:!0}),S(()=>n.version,(s,o)=>{s!==o&&n.tts_mode==="Dynamic"&&(n.model_name="",i.value="",n.prompt_text_lang="",n.emotion="",f(s))}),S(()=>n.tts_mode,s=>{s==="Dynamic"&&f(n.version)});const T=L(()=>{const s=g.getTtsModelData(n.version)||{},o=Object.keys(s);return i.value?o.filter(e=>e.toLowerCase().includes(i.value.toLowerCase())):o});async function f(s){if(!(!s||u.models==="loading")){u.models="loading";try{const o=g.getTtsModels(s),e=new Promise(t=>setTimeout(t,500));await Promise.all([o,e]),u.models="loaded"}catch(o){j(`Failed to fetch TTS models for version ${s}: ${o}`,"ERROR"),u.models="error"}}}function I(s){n.model_name=s,i.value=s,p.value=!1,n.prompt_text_lang="",n.emotion=""}function w(s){var e;const o=g.getTtsModelData(n.version);return s==="prompt_text_lang"?!n.model_name||!(o!=null&&o[n.model_name]):s==="emotion"?!n.prompt_text_lang||!((e=o==null?void 0:o[n.model_name])!=null&&e[n.prompt_text_lang]):!0}function C(s){return s==="prompt_text_lang"?n.model_name?"选择语言":"先选模型":s==="emotion"?n.prompt_text_lang?"选择情感":"先选语言":"..."}function O(s){const o=g.getTtsModelData(n.version),e=o?o[n.model_name]:null;return e?s==="prompt_text_lang"?Object.keys(e):s==="emotion"?e[n.prompt_text_lang]||[]:[]:[]}async function P(){const s={...k};D.forEach(o=>{n[o.key]!==void 0&&(s[o.key]=n[o.key])}),Object.keys(k).forEach(o=>{var e,t;if(!D.some(m=>m.key===o)){const m=h.contacts[b.contactId];s[o]=((t=(e=m==null?void 0:m.aiConfig)==null?void 0:e.tts)==null?void 0:t[o])??k[o]}}),await h.saveTtsSettings(b.contactId,s)}const $=()=>{p.value=!1};return N(()=>document.addEventListener("click",$)),R(()=>document.removeEventListener("click",$)),(s,o)=>(l(),a("div",H,[(l(),a(y,null,v(D,e=>_("div",{key:e.key,class:"tts-config-item"},[_("label",{for:`tts-${c.contactId}-${e.key}`},d(e.label),9,W),e.key==="tts_mode"?r((l(),a("select",{key:0,"onUpdate:modelValue":o[0]||(o[0]=t=>n.tts_mode=t),id:`tts-${c.contactId}-${e.key}`},[(l(!0),a(y,null,v(e.options,t=>(l(),a("option",{key:t.value,value:t.value},d(t.text),9,J))),128))],8,z)),[[x,n.tts_mode]]):e.key==="version"?r((l(),a("select",{key:1,"onUpdate:modelValue":o[1]||(o[1]=t=>n.version=t),id:`tts-${c.contactId}-${e.key}`},[(l(!0),a(y,null,v(e.options,t=>(l(),a("option",{key:t.value,value:t.value},d(t.text),9,Q))),128))],8,K)),[[x,n.version]]):e.key==="model_name"&&n.tts_mode==="Dynamic"?(l(),a("div",{key:2,class:"searchable-select",onClick:o[5]||(o[5]=B(()=>{},["stop"]))},[r(_("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=t=>i.value=t),onFocus:o[3]||(o[3]=t=>p.value=!0),onInput:o[4]||(o[4]=t=>p.value=!0),placeholder:u.models==="loading"?"加载中...":"搜索或选择模型",disabled:u.models!=="loaded"},null,40,X),[[G,i.value]]),p.value?(l(),a("div",Y,[(l(!0),a(y,null,v(T.value,t=>(l(),a("div",{key:t,onMousedown:m=>I(t),class:"option"},d(t),41,Z))),128)),!T.value.length&&i.value?(l(),a("div",ee,"无匹配项")):V("",!0)])):V("",!0)])):e.isPotentiallyDynamic&&n.tts_mode==="Dynamic"?r((l(),a("select",{key:3,"onUpdate:modelValue":t=>n[e.key]=t,disabled:w(e.key)},[_("option",oe,d(C(e.key)),1),(l(!0),a(y,null,v(O(e.key),t=>(l(),a("option",{key:t,value:t},d(t),9,ne))),128))],8,te)),[[x,n[e.key]]]):e.type==="checkbox"?r((l(),a("input",{key:4,type:"checkbox","onUpdate:modelValue":t=>n[e.key]=t,id:`tts-${c.contactId}-${e.key}`},null,8,se)),[[q,n[e.key]]]):e.type==="select"?r((l(),a("select",{key:5,"onUpdate:modelValue":t=>n[e.key]=t,id:`tts-${c.contactId}-${e.key}`},[(l(!0),a(y,null,v(e.options,t=>(l(),a("option",{key:t.value||t,value:t.value||t},d(t.text||t),9,le))),128))],8,ae)),[[x,n[e.key]]]):r((l(),a("input",{key:6,type:e.type,"onUpdate:modelValue":t=>n[e.key]=t,id:`tts-${c.contactId}-${e.key}`,step:e.step,min:e.min,max:e.max},null,8,ie)),[[A,n[e.key],void 0,{number:!0}]])])),64)),_("button",{class:"btn-primary btn-save-tts",onClick:P},"保存 TTS 设置")]))}},de=F(ce,[["__scopeId","data-v-80c40cdf"]]);export{de as default};
