const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ResourceGridItem-BMbt-LvJ.js","./index-dUS5mm6e.js","./index-5uDYxhLe.css","./ResourceGridItem-BFsrh_Oo.css","./ResourceTextItem-DDwqBplP.js","./ResourceTextItem-Ccups-PQ.css","./ResourceLocationItem-XsoP8rce.js","./ResourceLocationItem-DBirHSkT.css","./CalendarView-DjhliTAV.js","./CalendarView-D0kISgwQ.css"])))=>i.map(i=>d[i]);
import{_ as N,b as W,c as U,r as v,H as q,o as F,e as d,Y as h,l as n,h as i,j as o,p as y,X as j,n as c,g as T,a5 as V,F as G,s as Q,k as g,i as X,a1 as Y,a6 as Z,t as J,Z as _,a7 as K,A as S}from"./index-dUS5mm6e.js";const ee={class:"resource-preview-root"},te=["value"],ae={class:"resource-tabs"},se={key:0,class:"loading-state"},oe={key:1,class:"resource-view-wrapper"},ie={key:2,class:"calendar-wrapper"},re={key:3,class:"empty-state"},le={__name:"ResourcePreview",props:{chatId:{type:String,required:!0}},setup(k){const z=h(()=>_(()=>import("./ResourceGridItem-BMbt-LvJ.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)),E=h(()=>_(()=>import("./ResourceTextItem-DDwqBplP.js"),__vite__mapDeps([4,1,2,5]),import.meta.url)),M=h(()=>_(()=>import("./ResourceLocationItem-XsoP8rce.js"),__vite__mapDeps([6,1,2,7]),import.meta.url)),A=h(()=>_(()=>import("./CalendarView-DjhliTAV.js"),__vite__mapDeps([8,1,2,9]),import.meta.url)),C=k,P=W(),m=U(),r=v(""),a=v("media"),D=v(!1),l=v(null),p=v(0);let f=null;q(()=>{l.value&&(p.value=l.value.clientWidth,f=new ResizeObserver(t=>{t[0]&&(p.value=t[0].contentRect.width)}),f.observe(l.value))}),F(()=>{f&&l.value&&f.unobserve(l.value)});const b=j(t=>{r.value=t.target.value},300),u=t=>{a.value=t,r.value=""},O=d(()=>{if(!C.chatId)return[];const e={media:"imagery",text:"text",files:"other",location:"location"}[a.value];return e?P.getMessagesWithResources(C.chatId,e):[]}),R=d(()=>{const t=O.value||[];if(!r.value.trim())return t;const e=r.value.toLowerCase().trim();return t.filter(s=>{var w,x,L;return((w=s.originalSenderName)==null?void 0:w.toLowerCase().includes(e))||((x=s.content)==null?void 0:x.toLowerCase().includes(e))||((L=s.fileName)==null?void 0:L.toLowerCase().includes(e))})}),I=d(()=>{if(a.value==="media"||a.value==="files")return 3}),$=d(()=>(a.value==="media"||a.value==="files")&&p.value>0?Math.floor(p.value/I.value):72),B=d(()=>{switch(a.value){case"media":case"files":return z;case"text":return E;case"location":return M;default:return null}});async function H(t){if(t.type==="location")m.showLocationViewer({latitude:t.latitude,longitude:t.longitude});else if(["image","video","sticker"].includes(t.type)){const e=await K.getUrl(t.fileHash);e?m.showMediaViewer({type:t.type,fileType:t.fileType,src:e,alt:t.fileName}):S.emit("showNotification",{message:"无法加载媒体资源",type:"error"})}else S.emit("chat:scroll-to-message",t.id),window.innerWidth<=768&&(m.toggleDetailsPanel(!1),m.isChatViewActiveOnMobile=!0)}return(t,e)=>(i(),n("div",ee,[o("input",{type:"search",id:"resource-search-input",value:r.value,onInput:e[0]||(e[0]=(...s)=>y(b)&&y(b)(...s)),placeholder:"搜索资源...",class:"resource-search","aria-label":"搜索聊天中的资源"},null,40,te),o("nav",ae,[o("button",{class:c({active:a.value==="media"}),onClick:e[1]||(e[1]=s=>u("media"))},"媒体",2),o("button",{class:c({active:a.value==="text"}),onClick:e[2]||(e[2]=s=>u("text"))},"文本",2),o("button",{class:c({active:a.value==="files"}),onClick:e[3]||(e[3]=s=>u("files"))},"文件",2),o("button",{class:c({active:a.value==="location"}),onClick:e[4]||(e[4]=s=>u("location"))},"位置",2),o("button",{class:c({active:a.value==="calendar"}),onClick:e[5]||(e[5]=s=>u("calendar"))},"日历",2)]),o("div",{class:"resource-content",ref_key:"containerRef",ref:l},[D.value?(i(),n("div",se,[a.value!=="text"&&a.value!=="location"?(i(),T(V,{key:0,type:"grid"})):(i(),n(G,{key:1},Q(4,s=>g(V,{type:"list-item",key:s})),64))])):R.value.length>0?(i(),n("div",oe,[g(y(Z),{class:c(["scroller",{"grid-view":a.value==="media"||a.value==="files","list-view":a.value==="text"||a.value==="location"}]),items:R.value,"item-size":$.value,"key-field":"id",buffer:200,"grid-items":I.value,direction:"vertical"},{default:X(({item:s})=>[(i(),T(Y(B.value),{item:s,onClick:w=>H(s)},null,8,["item","onClick"]))]),_:1},8,["class","items","item-size","grid-items"])])):a.value==="calendar"?(i(),n("div",ie,[g(y(A),{"chat-id":k.chatId},null,8,["chat-id"])])):(i(),n("div",re,[e[6]||(e[6]=o("svg",{class:"empty-state-icon",viewBox:"0 0 24 24",fill:"currentColor"},[o("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"})],-1)),o("p",null,J(r.value?"无匹配结果":"此分类下无资源"),1)]))],512)]))}},ce=N(le,[["__scopeId","data-v-6a10c3a3"]]);export{ce as R};
