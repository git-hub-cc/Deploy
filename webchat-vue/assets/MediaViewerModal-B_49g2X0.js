import{_ as A,e as f,l as r,h as a,j as l,k as K,S as Z,m as O,z as U,t as w,n as j,c as ee,I as te,r as d,w as ne,K as se,H as le,o as oe,Q as ae,g as ie,i as ue,p as re,R as ve,v as ce,T as de}from"./index-dUS5mm6e.js";const me={class:"center-controls"},fe={key:0,class:"spinner-container"},ge={key:0,viewBox:"0 0 24 24"},pe={class:"bottom-bar"},he={class:"progress-bar-container"},ye=["max","value"],ke={class:"controls-row"},we={class:"controls-left"},be={key:0,viewBox:"0 0 24 24"},ze={key:1,viewBox:"0 0 24 24"},Me={class:"volume-control"},Ve={key:0,viewBox:"0 0 24 24"},Ce={key:1,viewBox:"0 0 24 24"},Te={key:2,viewBox:"0 0 24 24"},Ee=["value"],Se={class:"controls-right"},Le={class:"time-display"},$e={key:0,viewBox:"0 0 24 24"},xe={key:1,viewBox:"0 0 24 24"},Be={__name:"CustomVideoControls",props:{visible:Boolean,isPlaying:Boolean,isBuffering:Boolean,currentTime:Number,duration:Number,volume:Number,isMuted:Boolean,isFullscreen:Boolean},emits:["play-pause","seek","toggle-mute","set-volume","toggle-fullscreen"],setup(v){const c=v,p=o=>{if(isNaN(o)||o===1/0)return"00:00";const t=Math.floor(o),u=Math.floor(t/60),n=t%60;return`${String(u).padStart(2,"0")}:${String(n).padStart(2,"0")}`},i=f(()=>p(c.currentTime)),g=f(()=>p(c.duration)),b=f(()=>{const o=c.duration>0?c.currentTime/c.duration:0,t=o*100,u=16,n=u/2-o*u;return`calc(${t}% + ${n}px) 100%`}),z=f(()=>{const o=c.isMuted?0:c.volume,t=o*100,u=12,n=u/2-o*u;return`calc(${t}% + ${n}px) 100%`});return(o,t)=>(a(),r("div",{class:j(["controls-overlay",{visible:v.visible,"is-paused":!v.isPlaying}])},[l("div",me,[v.isBuffering?(a(),r("div",fe,[K(Z,{size:"large"})])):(a(),r("button",{key:1,class:"play-pause-center-btn",onClick:t[0]||(t[0]=u=>o.$emit("play-pause"))},[v.isPlaying?O("",!0):(a(),r("svg",ge,[...t[6]||(t[6]=[l("path",{d:"M8 5v14l11-7z"},null,-1)])]))]))]),l("div",pe,[l("div",he,[l("input",{type:"range",class:"progress-bar",min:0,max:v.duration,value:v.currentTime,onInput:t[1]||(t[1]=u=>o.$emit("seek",u.target.value)),style:U({backgroundSize:b.value})},null,44,ye)]),l("div",ke,[l("div",we,[l("button",{class:"control-btn",onClick:t[2]||(t[2]=u=>o.$emit("play-pause"))},[v.isPlaying?(a(),r("svg",be,[...t[7]||(t[7]=[l("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(a(),r("svg",ze,[...t[8]||(t[8]=[l("path",{d:"M8 5v14l11-7z"},null,-1)])]))]),l("div",Me,[l("button",{class:"control-btn",onClick:t[3]||(t[3]=u=>o.$emit("toggle-mute"))},[v.isMuted||v.volume===0?(a(),r("svg",Ve,[...t[9]||(t[9]=[l("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"},null,-1)])])):v.volume>.5?(a(),r("svg",Ce,[...t[10]||(t[10]=[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"},null,-1)])])):(a(),r("svg",Te,[...t[11]||(t[11]=[l("path",{d:"M7 9v6h4l5 5V4L11 9H7zm7.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"},null,-1)])]))]),l("input",{type:"range",class:"volume-slider",min:"0",max:"1",step:"0.01",value:v.isMuted?0:v.volume,onInput:t[4]||(t[4]=u=>o.$emit("set-volume",u.target.value)),style:U({backgroundSize:z.value})},null,44,Ee)])]),l("div",Se,[l("span",Le,w(i.value)+" / "+w(g.value),1),l("button",{class:"control-btn",onClick:t[5]||(t[5]=u=>o.$emit("toggle-fullscreen"))},[v.isFullscreen?(a(),r("svg",$e,[...t[12]||(t[12]=[l("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"},null,-1)])])):(a(),r("svg",xe,[...t[13]||(t[13]=[l("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},null,-1)])]))])])])])],2))}},_e=A(Be,[["__scopeId","data-v-6fc7e422"]]),Pe=["src","alt"],Fe={key:1,class:"video-wrapper"},He=["src"],Ne=["src"],De={key:3,class:"text-preview-wrapper"},Ie={class:"media-content text-content"},Re={key:4,class:"unsupported-preview"},We={__name:"MediaViewerModal",setup(v){const c=ee(),p=te(),i=f(()=>c.mediaViewerContent),g=d(""),b=f(()=>p.isCallActive&&!p.isFullScreenCallViewVisible),z=f(()=>{var e,s,m;return((s=(e=i.value)==null?void 0:e.fileType)==null?void 0:s.startsWith("image/"))||((m=i.value)==null?void 0:m.type)==="image"}),o=f(()=>{var e,s,m;return((s=(e=i.value)==null?void 0:e.fileType)==null?void 0:s.startsWith("video/"))||((m=i.value)==null?void 0:m.type)==="video"}),t=f(()=>{var e;return((e=i.value)==null?void 0:e.fileType)==="application/pdf"}),u=f(()=>{var e,s;return(s=(e=i.value)==null?void 0:e.fileType)==null?void 0:s.startsWith("text/")}),n=d(null),x=d(null),h=d(!1),k=d(!1),M=d(0),V=d(0),C=d(1),T=d(!1),E=d(!1),S=d(!0);let y=null;const q=()=>{n.value&&(h.value=!n.value.paused,M.value=n.value.currentTime,V.value=n.value.duration,C.value=n.value.volume,T.value=n.value.muted)},B=()=>{n.value&&(M.value=n.value.currentTime)},_=()=>{n.value&&(V.value=n.value.duration)},P=()=>{h.value=!0,k.value=!1},F=()=>{h.value=!1},H=()=>{n.value&&(C.value=n.value.volume,T.value=n.value.muted)},N=()=>{k.value=!0},D=()=>{k.value=!1},I=()=>{E.value=!!document.fullscreenElement},L=()=>{var e,s,m;return(e=n.value)!=null&&e.paused?(s=n.value)==null?void 0:s.play():(m=n.value)==null?void 0:m.pause()},Q=e=>{n.value&&(n.value.currentTime=e)},G=e=>{n.value&&(n.value.volume=e,n.value.muted=!1)},J=()=>{n.value&&(n.value.muted=!n.value.muted)},X=()=>{var e;document.fullscreenElement?document.exitFullscreen():(e=x.value)==null||e.requestFullscreen()},R=()=>{S.value=!0,y&&clearTimeout(y),y=setTimeout(()=>{h.value&&(S.value=!1)},3e3)},$=()=>{c.hideOverlayModal()},W=e=>{e.key==="Escape"&&(E.value?document.exitFullscreen():$()),o.value&&e.key===" "&&n.value&&(e.preventDefault(),L())};ne(i,async e=>{if(e&&u.value)try{const s=await fetch(e.src);if(!s.ok)throw new Error("Network response was not ok");g.value=await s.text()}catch(s){g.value="无法加载文件内容。",console.error("Error fetching text file for preview:",s)}else g.value="";if(e&&o.value){await se();const s=n.value;s&&(s.addEventListener("timeupdate",B),s.addEventListener("durationchange",_),s.addEventListener("play",P),s.addEventListener("pause",F),s.addEventListener("volumechange",H),s.addEventListener("waiting",N),s.addEventListener("playing",D),q(),R())}},{immediate:!0});function Y(){var s;if(!((s=i.value)!=null&&s.src))return;const e=document.createElement("a");e.href=i.value.src,e.download=i.value.alt||"download",document.body.appendChild(e),e.click(),document.body.removeChild(e)}return le(()=>{window.addEventListener("keydown",W),document.addEventListener("fullscreenchange",I)}),oe(()=>{window.removeEventListener("keydown",W),document.removeEventListener("fullscreenchange",I);const e=n.value;e&&(e.removeEventListener("timeupdate",B),e.removeEventListener("durationchange",_),e.removeEventListener("play",P),e.removeEventListener("pause",F),e.removeEventListener("volumechange",H),e.removeEventListener("waiting",N),e.removeEventListener("playing",D)),y&&clearTimeout(y)}),(e,s)=>{const m=ae("motion-pop");return a(),ie(de,{name:"media-viewer-fade"},{default:ue(()=>[re(c).activeOverlayModal==="mediaViewer"&&i.value?(a(),r("div",{key:0,class:j(["viewer-backdrop",{"widget-active":b.value}]),onClick:ve($,["self"]),onMousemove:R},[l("button",{class:"close-button",onClick:$,title:"关闭 (Esc)"},"×"),ce((a(),r("div",{class:"media-container",ref_key:"mediaContainerRef",ref:x},[z.value?(a(),r("img",{key:0,src:i.value.src,alt:i.value.alt,class:"media-content",loading:"lazy"},null,8,Pe)):o.value?(a(),r("div",Fe,[l("video",{ref_key:"videoRef",ref:n,src:i.value.src,class:"media-content",autoplay:"",onClick:L},null,8,He),K(_e,{visible:S.value,"is-playing":h.value,"is-buffering":k.value,"current-time":M.value,duration:V.value,volume:C.value,"is-muted":T.value,"is-fullscreen":E.value,onPlayPause:L,onSeek:Q,onSetVolume:G,onToggleMute:J,onToggleFullscreen:X},null,8,["visible","is-playing","is-buffering","current-time","duration","volume","is-muted","is-fullscreen"])])):t.value?(a(),r("iframe",{key:2,src:i.value.src,class:"media-content iframe-content",frameborder:"0"},null,8,Ne)):u.value?(a(),r("div",De,[l("pre",Ie,w(g.value||"加载中..."),1)])):(a(),r("div",Re,[s[0]||(s[0]=l("p",null,"不支持预览此文件类型",-1)),l("span",null,w(i.value.alt),1),l("button",{onClick:Y},"下载文件")]))])),[[m]])],34)):O("",!0)]),_:1})}}},Ae=A(We,[["__scopeId","data-v-570e519a"]]);export{Ae as default};
