import{_ as g,a as k,c as S,r as w,e as U,H as x,Q as L,l as n,h as o,j as i,t as r,k as d,n as _,M as I,i as T,v as N,F as v,s as h,a5 as O,m as p,O as B,T as D,A as f,f as P}from"./index-dUS5mm6e.js";const $={class:"people-lobby-root"},A={class:"lobby-header"},M={class:"lobby-list-container"},V={key:0,class:"loading-state scroller"},F={key:1,class:"empty-state"},W={key:2,class:"lobby-list scroller"},j=["onClick"],z={class:"user-info"},E={class:"user-name"},H=["title"],Q={key:0,class:"contact-indicator"},R={__name:"PeopleLobby",setup(q){const l=k(),y=S(),c=w(!1),u=U(()=>l.allOnlineUsers.map(t=>{const e=l.contacts[t.userId],a=l.getContactCombinedStatus(t.userId);return{id:t.userId,name:e?e.name:`用户 ${t.userId.substring(0,6)}`,avatarText:e?e.avatarText:t.userId.charAt(0).toUpperCase(),avatarUrl:e?e.avatarUrl:null,isContact:!!e,type:"contact",originServer:t.originServer,isLocal:t.isLocal,isOnline:a.isOnlineDisplay,statusText:a.statusText,statusClass:a.statusClass}}));async function m(){c.value=!0;const t=l.fetchAllOnlineUsers(),e=new Promise(a=>setTimeout(a,400));try{await Promise.all([t,e])}catch(a){console.error("刷新用户列表时出错，但动画将平滑结束:",a)}finally{c.value=!1}}function C(t){if(t.isContact){l.getContactCombinedStatus(t.id).isConnected?f.emit("showNotification",{message:`${t.name} 已在您的联系人列表中并已连接。`,type:"info"}):(f.emit("showNotification",{message:`正在尝试连接 ${t.name}...`,type:"info"}),P.createOffer(t.id));return}y.showModal("newContact",{prefillId:t.id,prefillName:t.name.startsWith("用户 ")?"":t.name})}function b(t){try{const e=t.startsWith("http")?t:`http://${t}`;return new URL(e).hostname.replace(/^www\./,"")}catch{return t}}return x(()=>{m()}),(t,e)=>{const a=L("auto-animate");return o(),n("div",$,[i("div",A,[i("h4",null,"全部在线用户 ("+r(u.value.length)+")",1),i("div",null,[d(I,{icon:"icons/refresh.svg",title:"刷新列表",class:_({loading:c.value}),onClick:m},null,8,["class"])])]),i("div",M,[d(D,{name:"content-fade",mode:"out-in"},{default:T(()=>[c.value?(o(),n("div",V,[(o(),n(v,null,h(8,s=>d(O,{type:"list-item",key:s})),64))])):u.value.length===0?(o(),n("div",F," 当前无在线用户 ")):N((o(),n("div",W,[(o(!0),n(v,null,h(u.value,s=>(o(),n("div",{key:s.id,class:"lobby-item",onClick:G=>C(s)},[d(B,{entity:s,"is-online":s.isOnline},null,8,["entity","is-online"]),i("div",z,[i("span",E,r(s.name),1),i("span",{class:_(["user-status",s.statusClass])},r(s.statusText),3),s.isLocal?p("",!0):(o(),n("span",{key:0,class:"origin-server",title:s.originServer},r(b(s.originServer)),9,H))]),s.isContact?(o(),n("span",Q,"✓")):p("",!0)],8,j))),128))])),[[a,{duration:300}]])]),_:1})])])}}},K=g(R,[["__scopeId","data-v-952ab995"]]);export{K as default};
