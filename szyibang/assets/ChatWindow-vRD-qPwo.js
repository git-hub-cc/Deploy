import{_ as M}from"./_plugin-vue_export-helper-DRcqrMy4.js";import{v as R}from"./el-loading-CDKhOZ5N.js";/* empty css                  */import{E as W}from"./el-progress-xYuBwGGD.js";/* empty css                 */import{E as H}from"./el-image-viewer-Cfn1FMc4.js";import{E as K}from"./el-avatar-_8QHTF_R.js";import{b as j,r as u,D as q,d as G,e as r,f as c,U as O,V as $,W as J,H as Q,G as m,h as n,g as k,t as x,k as X,w as p,a8 as U,m as Y,O as _,o,P as Z,a9 as ee,i as te,E as oe,j as ae,l as y,aa as se,v as C}from"./index-Bd4-WGnv.js";import{A as ne}from"./AudioInput-UdpFeN70.js";const re={class:"chat-container"},ie={class:"avatar"},le={class:"content"},ce={key:0,class:"bubble text"},de=["onClick"],ue={key:2,class:"bubble image"},me={class:"input-area","element-loading-text":"正在上传语音...","element-loading-background":"rgba(255, 255, 255, 0.7)"},pe={class:"main-input"},_e={__name:"ChatWindow",props:{messages:{type:Array,default:()=>[]}},emits:["send"],setup(g,{emit:E}){var w;const T=g,f=E,V=(w=j().userInfo)==null?void 0:w.id,d=u(null),i=u(""),l=u(!1),v=u(!1);q(()=>T.messages,()=>{se(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})},{deep:!0,immediate:!0});function b(){i.value.trim()&&(f("send",{msgType:1,textContent:i.value}),i.value="")}async function D(a){const t=new FormData;t.append("file",a.file);try{const s=await C(t);f("send",{msgType:3,mediaUrl:s})}catch(s){console.error("图片上传失败:",s)}}async function I(a){if(!a||a.size===0){y.warning("录音文件无效");return}v.value=!0;try{const t=new FormData;t.append("file",a);const s=await C(t);if(s)f("send",{msgType:2,mediaUrl:s,audioDuration:5});else throw new Error("服务器未返回有效的语音文件URL")}catch(t){console.error("语音上传失败:",t)}finally{v.value=!1}}function A(){l.value=!l.value}function z(a){if(!a){y.error("音频地址无效，无法播放");return}console.log("播放音频",a),new Audio(a).play().catch(s=>{console.error("音频播放失败:",s),y.error("音频播放失败")})}return(a,t)=>{const s=K,h=Y,B=H,L=oe,N=G("Picture"),P=W,S=ae,F=R;return o(),r("div",re,[c("div",{class:"message-list",ref_key:"msgListRef",ref:d},[(o(!0),r($,null,J(g.messages,e=>(o(),r("div",{key:e.id,class:Q(["message-item",{"is-me":e.senderId===m(V)}])},[c("div",ie,[n(s,{size:36,src:e.senderAvatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"},null,8,["src"])]),c("div",le,[e.msgType===1?(o(),r("div",ce,x(e.textContent),1)):e.msgType===2?(o(),r("div",{key:1,class:"bubble audio",onClick:ve=>z(e.mediaUrl)},[n(h,null,{default:p(()=>[n(m(U))]),_:1}),X(" "+x(e.audioDuration)+"s ",1)],8,de)):e.msgType===3?(o(),r("div",ue,[n(B,{style:{width:"100px",height:"100px","border-radius":"4px"},src:e.mediaUrl,"preview-src-list":[e.mediaUrl],fit:"cover"},null,8,["src","preview-src-list"])])):k("",!0)])],2))),128))],512),O((o(),r("div",me,[c("div",{class:"tool-btn",onClick:A},[n(h,{size:"24"},{default:p(()=>[(o(),_(Z(l.value?m(ee):m(U))))]),_:1})]),c("div",pe,[l.value?(o(),_(ne,{key:1,onFinish:I})):(o(),_(L,{key:0,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),placeholder:"发送消息...",onKeyup:te(b,["enter"])},null,8,["modelValue"]))]),n(P,{class:"upload-demo tool-btn",action:"#","show-file-list":!1,"http-request":D},{default:p(()=>[n(h,{size:"24"},{default:p(()=>[n(N)]),_:1})]),_:1}),l.value?k("",!0):(o(),_(S,{key:0,type:"primary",circle:"",icon:"Position",onClick:b}))])),[[F,v.value]])])}}},Ee=M(_e,[["__scopeId","data-v-c908cdb5"]]);export{Ee as C};
