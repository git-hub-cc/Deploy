import{bX as Ve,z as ye,y as Se,af as J,ae as Ce,_ as Ne,A as Te,ao as ze,cK as Ye,cL as Be,aA as Oe,B as $e,bN as De,r as p,cM as Fe,p as d,bl as He,a7 as We,bQ as je,D as ie,q as Re,av as Y,O as be,o as I,w as m,h as u,X as Ke,f as k,N as Ee,H as v,G as s,bo as qe,g as S,e as R,F as T,a5 as Ge,m as A,R as Qe,V as ke,cG as Ze,b5 as Ue,k as Je,t as _e,cN as ea,aI as aa,P as sa,cO as ta,cP as na,cQ as oa,ar as la,as as q,aa as xe,T as Pe,cR as ra,ct as ia,cS as ua,bz as U,am as ca,cT as da,aR as Le,aQ as fa,aW as we,aX as he,bG as va,ap as ma,cU as pa,cV as ga,cW as wa}from"./index-Dczg_W-s.js";import{E as ha}from"./index-D5yFMpEK.js";import{d as ya}from"./debounce-D6x4jhS0.js";var ba="Expected a function";function re(i,B,O){var c=!0,f=!0;if(typeof i!="function")throw new TypeError(ba);return Ve(O)&&(c="leading"in O?!!O.leading:c,f="trailing"in O?!!O.trailing:f),ya(i,B,{leading:c,maxWait:B,trailing:f})}const ka=Se({urlList:{type:J(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:J(String)}}),Ia={close:()=>!0,error:i=>i instanceof Event,switch:i=>ye(i),rotate:i=>ye(i)},za=["src","crossorigin"],Ea=Te({name:"ElImageViewer",__name:"image-viewer",props:ka,emits:Ia,setup(i,{expose:B,emit:O}){var c;const f={CONTAIN:{name:"contain",icon:ze(Be)},ORIGINAL:{name:"original",icon:ze(Ye)}},r=i,g=O;let G;const{t:ee}=Oe(),o=$e("image-viewer"),{nextZIndex:Q}=De(),z=p(),$=p(),D=Fe(),_=d(()=>{const{scale:e,minScale:t,maxScale:l}=r;return He(e,t,l)}),w=p(!0),X=p(!1),x=p(!1),h=p(r.initialIndex),F=We(f.CONTAIN),n=p({scale:_.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ue=p((c=r.zIndex)!=null?c:Q());je(x,{ns:o});const ae=d(()=>{const{urlList:e}=r;return e.length<=1}),H=d(()=>h.value===0),se=d(()=>h.value===r.urlList.length-1),W=d(()=>r.urlList[h.value]),ce=d(()=>[o.e("btn"),o.e("prev"),o.is("disabled",!r.infinite&&H.value)]),te=d(()=>[o.e("btn"),o.e("next"),o.is("disabled",!r.infinite&&se.value)]),ne=d(()=>{const{scale:e,deg:t,offsetX:l,offsetY:L,enableTransition:C}=n.value;let b=l/e,N=L/e;const K=t*Math.PI/180,V=Math.cos(K),Z=Math.sin(K);b=b*V+N*Z,N=N*V-l/e*Z;const ge={transform:`scale(${e}) rotate(${t}deg) translate(${b}px, ${N}px)`,transition:C?"transform .3s":""};return F.value.name===f.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),oe=d(()=>`${h.value+1} / ${r.urlList.length}`);function M(){fe(),G==null||G(),x.value=!1,g("close")}function de(){const e=re(l=>{switch(la(l)){case q.esc:r.closeOnPressEscape&&M();break;case q.space:ve();break;case q.left:me();break;case q.up:P("zoomIn");break;case q.right:pe();break;case q.down:P("zoomOut");break}}),t=re(l=>{const L=l.deltaY||l.deltaX;P(L<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});D.run(()=>{Y(document,"keydown",e),Y(z,"wheel",t)})}function fe(){D.stop()}function a(){w.value=!1}function E(e){X.value=!0,w.value=!1,g("error",e),e.target.alt=ee("el.image.error")}function y(e){if(w.value||e.button!==0||!z.value)return;n.value.enableTransition=!1;const{offsetX:t,offsetY:l}=n.value,L=e.pageX,C=e.pageY,b=re(V=>{n.value={...n.value,offsetX:t+V.pageX-L,offsetY:l+V.pageY-C}}),N=Y(document,"mousemove",b),K=Y(document,"mouseup",()=>{N(),K()});e.preventDefault()}function j(e){if(w.value||!z.value||e.touches.length!==1)return;n.value.enableTransition=!1;const{offsetX:t,offsetY:l}=n.value,{pageX:L,pageY:C}=e.touches[0],b=re(V=>{const Z=V.touches[0];n.value={...n.value,offsetX:t+Z.pageX-L,offsetY:l+Z.pageY-C}}),N=Y(document,"touchmove",b),K=Y(document,"touchend",()=>{N(),K()});e.preventDefault()}function Ie(){n.value={scale:_.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ve(){if(w.value||X.value)return;const e=oa(f),t=Object.values(f),l=F.value.name,C=(t.findIndex(b=>b.name===l)+1)%e.length;F.value=f[e[C]],Ie()}function le(e){X.value=!1;const t=r.urlList.length;h.value=(e+t)%t}function me(){H.value&&!r.infinite||le(h.value-1)}function pe(){se.value&&!r.infinite||le(h.value+1)}function P(e,t={}){if(w.value||X.value)return;const{minScale:l,maxScale:L}=r,{zoomRate:C,rotateDeg:b,enableTransition:N}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":n.value.scale>l&&(n.value.scale=Number.parseFloat((n.value.scale/C).toFixed(3)));break;case"zoomIn":n.value.scale<L&&(n.value.scale=Number.parseFloat((n.value.scale*C).toFixed(3)));break;case"clockwise":n.value.deg+=b,g("rotate",n.value.deg);break;case"anticlockwise":n.value.deg-=b,g("rotate",n.value.deg);break}n.value.enableTransition=N}function Ae(e){var t;((t=e.detail)==null?void 0:t.focusReason)==="pointer"&&e.preventDefault()}function Xe(){r.closeOnPressEscape&&M()}function Me(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ie(()=>_.value,e=>{n.value.scale=e}),ie(W,()=>{xe(()=>{const e=$.value;e!=null&&e.complete||(w.value=!0)})}),ie(h,e=>{Ie(),g("switch",e)}),Re(()=>{x.value=!0,de(),G=Y("wheel",Me,{passive:!1})}),B({setActiveItem:le}),(e,t)=>(I(),be(s(ha),{to:"body",disabled:!e.teleported},{default:m(()=>[u(Ke,{name:"viewer-fade",appear:""},{default:m(()=>[k("div",{ref_key:"wrapper",ref:z,tabindex:-1,class:v(s(o).e("wrapper")),style:Ee({zIndex:ue.value})},[u(s(qe),{loop:"",trapped:"","focus-trap-el":z.value,"focus-start-el":"container",onFocusoutPrevented:Ae,onReleaseRequested:Xe},{default:m(()=>[k("div",{class:v(s(o).e("mask")),onClick:t[0]||(t[0]=Ge(l=>e.hideOnClickModal&&M(),["self"]))},null,2),S(" CLOSE "),k("span",{class:v([s(o).e("btn"),s(o).e("close")]),onClick:M},[u(s(A),null,{default:m(()=>[u(s(Qe))]),_:1})],2),S(" ARROW "),ae.value?S("v-if",!0):(I(),R(ke,{key:0},[k("span",{class:v(ce.value),onClick:me},[u(s(A),null,{default:m(()=>[u(s(Ze))]),_:1})],2),k("span",{class:v(te.value),onClick:pe},[u(s(A),null,{default:m(()=>[u(s(Ue))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(I(),R("div",{key:1,class:v([s(o).e("btn"),s(o).e("progress")])},[T(e.$slots,"progress",{activeIndex:h.value,total:e.urlList.length},()=>[Je(_e(oe.value),1)])],2)):S("v-if",!0),S(" ACTIONS "),k("div",{class:v([s(o).e("btn"),s(o).e("actions")])},[k("div",{class:v(s(o).e("actions__inner"))},[T(e.$slots,"toolbar",{actions:P,prev:me,next:pe,reset:ve,activeIndex:h.value,setActiveItem:le},()=>[u(s(A),{onClick:t[1]||(t[1]=l=>P("zoomOut"))},{default:m(()=>[u(s(ea))]),_:1}),u(s(A),{onClick:t[2]||(t[2]=l=>P("zoomIn"))},{default:m(()=>[u(s(aa))]),_:1}),k("i",{class:v(s(o).e("actions__divider"))},null,2),u(s(A),{onClick:ve},{default:m(()=>[(I(),be(sa(F.value.icon)))]),_:1}),k("i",{class:v(s(o).e("actions__divider"))},null,2),u(s(A),{onClick:t[3]||(t[3]=l=>P("anticlockwise"))},{default:m(()=>[u(s(ta))]),_:1}),u(s(A),{onClick:t[4]||(t[4]=l=>P("clockwise"))},{default:m(()=>[u(s(na))]),_:1})])],2)],2),S(" CANVAS "),k("div",{class:v(s(o).e("canvas"))},[X.value&&e.$slots["viewer-error"]?T(e.$slots,"viewer-error",{key:0,activeIndex:h.value,src:W.value}):(I(),R("img",{ref_key:"imgRef",ref:$,key:W.value,src:W.value,style:Ee(ne.value),class:v(s(o).e("img")),crossorigin:e.crossorigin,onLoad:a,onError:E,onMousedown:y,onTouchstart:j},null,46,za))],2),T(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var La=Ne(Ea,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const Sa=Pe(La),Ca=Se({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:J([String,Object])},previewSrcList:{type:J(Array),default:()=>Ce([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:J(String)}}),Na={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ye(i),close:()=>!0,show:()=>!0},Ta=["src","loading","crossorigin"],Oa={key:0},$a=Te({name:"ElImage",inheritAttrs:!1,__name:"image",props:Ca,emits:Na,setup(i,{expose:B,emit:O}){const c=i,f=O,{t:r}=Oe(),g=$e("image"),G=ra(),ee=d(()=>ia(Object.entries(G).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),o=ua({excludeListeners:!0,excludeKeys:d(()=>Object.keys(ee.value))}),Q=p(),z=p(!1),$=p(!0),D=p(!1),_=p(),w=p(),X=U&&"loading"in HTMLImageElement.prototype;let x;const h=d(()=>[g.e("inner"),n.value&&g.e("preview"),$.value&&g.is("loading")]),F=d(()=>{const{fit:a}=c;return U&&a?{objectFit:a}:{}}),n=d(()=>{const{previewSrcList:a}=c;return ca(a)&&a.length>0}),ue=d(()=>{const{previewSrcList:a,initialIndex:E}=c;let y=E;return E>a.length-1&&(y=0),y}),ae=d(()=>c.loading==="eager"?!1:!X&&c.loading==="lazy"||c.lazy),H=()=>{U&&($.value=!0,z.value=!1,Q.value=c.src)};function se(a){$.value=!1,z.value=!1,f("load",a)}function W(a){$.value=!1,z.value=!0,f("error",a)}function ce(a){a&&(H(),oe())}const te=da(ce,200,!0);async function ne(){var a;if(!U)return;await xe();const{scrollContainer:E}=c;if(va(E))w.value=E;else if(ma(E)&&E!=="")w.value=(a=document.querySelector(E))!=null?a:void 0;else if(_.value){const j=pa(_.value);w.value=ga(j)?void 0:j}const{stop:y}=wa(_,([j])=>{te(j.isIntersecting)},{root:w});x=y}function oe(){!U||!te||(x==null||x(),w.value=void 0,x=void 0)}function M(){n.value&&(D.value=!0,f("show"))}function de(){D.value=!1,f("close")}function fe(a){f("switch",a)}return ie(()=>c.src,()=>{ae.value?($.value=!0,z.value=!1,oe(),ne()):H()}),Re(()=>{ae.value?ne():H()}),B({showPreview:M}),(a,E)=>(I(),R("div",Le({ref_key:"container",ref:_},ee.value,{class:[s(g).b(),a.$attrs.class]}),[z.value?T(a.$slots,"error",{key:0},()=>[k("div",{class:v(s(g).e("error"))},_e(s(r)("el.image.error")),3)]):(I(),R(ke,{key:1},[Q.value!==void 0?(I(),R("img",Le({key:0},s(o),{src:Q.value,loading:a.loading,style:F.value,class:h.value,crossorigin:a.crossorigin,onClick:M,onLoad:se,onError:W}),null,16,Ta)):S("v-if",!0),$.value?(I(),R("div",{key:1,class:v(s(g).e("wrapper"))},[T(a.$slots,"placeholder",{},()=>[k("div",{class:v(s(g).e("placeholder"))},null,2)])],2)):S("v-if",!0)],64)),n.value?(I(),R(ke,{key:2},[D.value?(I(),be(s(Sa),{key:0,"z-index":a.zIndex,"initial-index":ue.value,infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,scale:a.scale,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:de,onSwitch:fe},fa({toolbar:m(y=>[T(a.$slots,"toolbar",we(he(y)))]),default:m(()=>[a.$slots.viewer?(I(),R("div",Oa,[T(a.$slots,"viewer")])):S("v-if",!0)]),_:2},[a.$slots.progress?{name:"progress",fn:m(y=>[T(a.$slots,"progress",we(he(y)))]),key:"0"}:void 0,a.$slots["viewer-error"]?{name:"viewer-error",fn:m(y=>[T(a.$slots,"viewer-error",we(he(y)))]),key:"1"}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):S("v-if",!0)],64)):S("v-if",!0)],16))}});var Ra=Ne($a,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Aa=Pe(Ra);export{Aa as E};
