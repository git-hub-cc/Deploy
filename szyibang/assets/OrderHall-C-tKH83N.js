import{_ as Y}from"./_plugin-vue_export-helper-DRcqrMy4.js";import{v as A}from"./el-loading-CZvZ1YE_.js";import{E as J}from"./el-empty-DZ3VuUlJ.js";/* empty css               */import{E as K}from"./el-switch-riPBKElL.js";/* empty css                  */import{u as Q,b as X,r as _,p as Z,q as ee,l as y,Y as te,d as S,e as l,f as a,U as se,h as o,w as c,m as ae,j as oe,V,W as O,k as f,O as T,g as D,G as k,t as r,x as E,o as n,H as ne}from"./index-Dczg_W-s.js";import{u as le}from"./location-Cz1mA6wL.js";import{g as ie,a as ce}from"./responder-C44x3bf_.js";import{g as $}from"./format-68UbSpw-.js";import{g as re,M as de}from"./MapContainer-1ZqF2xoe.js";import{E as ue}from"./index-CsPiBT-M.js";import"./theme-CFdUErEm.js";const pe={class:"order-hall mobile-view-wrapper"},me={class:"hall-header"},_e={class:"header-left"},fe={class:"actions"},ve={class:"filter-bar"},ge={class:"content-area"},he={key:0,class:"list-view"},ye={class:"card-header flex-between"},ke={class:"flex-center"},we={class:"category ml-2"},Ce={key:0,class:"distance"},xe={key:1,class:"distance"},be={class:"card-body"},Le={class:"title text-ellipsis"},Se={class:"address text-ellipsis"},Ee={class:"price"},Be={class:"card-footer"},Me={key:1,class:"map-view"},Ne={key:0,class:"map-card-popup"},Ve={class:"popup-content"},Oe={class:"title"},Te={class:"desc"},De={__name:"OrderHall",setup($e){const w=Q(),i=le(),v=X(),C=_(!1),x=_(!1),B=_([]),g=_(null),u=_([]),p=_(null),z=Z(()=>u.value.map(s=>({position:[s.lng||0,s.lat||0],title:s.title,orderId:s.id,rawData:s})));ee(async()=>{I(),v.refreshProfile(),await F()});async function I(){try{const s=await re();i.updateLocation(s.lat,s.lng,s.address),u.value.length===0&&m()}catch{i.latitude&&i.longitude?(y.warning("定位失败，使用默认位置"),m()):(y.warning("定位失败，显示所有订单"),i.updateLocation(39.9042,116.4074,"位置未知"),m(!0))}}async function F(){B.value=await te(),u.value.length===0&&m()}function M(s){g.value=s,m()}async function m(s=!1){x.value=!0;try{let e=i.latitude,d=i.longitude;(s||!i.isLocated)&&(e=null,d=null),u.value=await ie(e,d,g.value)||[]}finally{x.value=!1}}function H(s){p.value=s.rawData}function P(){E.confirm("确定要退出当前账号吗？","退出登录",{type:"warning"}).then(()=>{v.logout(),w.push("/login"),y.success("已退出登录")}).catch(()=>{})}function N(s){if(v.authStatus!==2){let e="认证状态异常，无法接单。",d="去认证";switch(v.authStatus){case 0:e="您尚未提交资质认证，无法接单。";break;case 1:e="您的资质正在审核中，请耐心等待。",d="知道了";break;case 3:e="您的资质审核未通过，请修改后重新提交。";break}E.confirm(e,"无法抢单",{confirmButtonText:d,cancelButtonText:"取消",type:"warning"}).then(()=>{v.authStatus!==1&&w.push("/responder/certification")}).catch(()=>{});return}E.confirm("确定要抢下这个订单吗？请确保能及时赶到现场。","抢单确认",{type:"warning",confirmButtonText:"立即出发"}).then(async()=>{await ce(s),y.success("抢单成功！"),w.push("/responder/tasks")})}return(s,e)=>{const d=S("SwitchButton"),b=ae,h=oe,U=K,L=ue,G=J,R=S("Location"),j=S("Close"),q=A;return n(),l("div",pe,[a("div",me,[a("div",_e,[o(h,{link:"",class:"logout-btn",onClick:P},{default:c(()=>[o(b,{size:20},{default:c(()=>[o(d)]),_:1})]),_:1}),e[4]||(e[4]=a("div",{class:"title"},"抢单大厅",-1))]),a("div",fe,[o(U,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),"active-text":"地图","inactive-text":"列表","inline-prompt":"",style:{"margin-right":"10px"}},null,8,["modelValue"]),o(h,{circle:"",icon:"Refresh",onClick:m})])]),a("div",ve,[(n(!0),l(V,null,O(B.value,t=>(n(),T(L,{key:t.id,effect:g.value===t.id?"dark":"plain",class:"filter-item",onClick:W=>M(t.id)},{default:c(()=>[f(r(t.catName),1)]),_:2},1032,["effect","onClick"]))),128)),o(L,{effect:g.value===null?"dark":"plain",onClick:e[1]||(e[1]=t=>M(null))},{default:c(()=>[...e[5]||(e[5]=[f("全部",-1)])]),_:1},8,["effect"])]),se((n(),l("div",ge,[C.value?(n(),l("div",Me,[o(de,{height:"calc(100vh - 210px)",center:[k(i).longitude,k(i).latitude],markers:z.value,clickable:"",onMarkerClick:H},null,8,["center","markers"]),p.value?(n(),l("div",Ne,[a("div",Ve,[a("div",Oe,r(p.value.title),1),a("div",Te,r(p.value.addressName),1),o(h,{type:"primary",size:"small",class:"mt-2",onClick:e[2]||(e[2]=t=>N(p.value.orderSn))},{default:c(()=>[...e[7]||(e[7]=[f("抢单",-1)])]),_:1})]),a("div",{class:"close-btn",onClick:e[3]||(e[3]=t=>p.value=null)},[o(b,null,{default:c(()=>[o(j)]),_:1})])])):D("",!0)])):(n(),l("div",he,[u.value.length===0?(n(),T(G,{key:0,description:"暂无新订单"})):D("",!0),(n(!0),l(V,null,O(u.value,t=>(n(),l("div",{key:t.id,class:ne(["order-card",{"is-emergency":t.priorityLevel===1}])},[a("div",ye,[a("div",ke,[o(L,{size:"small",type:k($)(t.priorityLevel).type},{default:c(()=>[f(r(k($)(t.priorityLevel).text),1)]),_:2},1032,["type"]),a("span",we,r(t.categoryName),1)]),t.distance?(n(),l("span",Ce,r((t.distance/1e3).toFixed(1))+" km ",1)):(n(),l("span",xe," 距离未知 "))]),a("div",be,[a("h3",Le,r(t.title),1),a("p",Se,[o(b,null,{default:c(()=>[o(R)]),_:1}),f(" "+r(t.addressName),1)]),a("div",Ee,"预计收益: ¥ "+r(t.responderIncome||"??"),1)]),a("div",Be,[o(h,{type:"primary",class:"grab-btn",onClick:W=>N(t.orderSn)},{default:c(()=>[...e[6]||(e[6]=[f("立即抢单",-1)])]),_:1},8,["onClick"])])],2))),128))]))])),[[q,x.value]])])}}},Je=Y(De,[["__scopeId","data-v-ad1301cb"]]);export{Je as default};
