import{_ as $}from"./_plugin-vue_export-helper-DRcqrMy4.js";import{E as A}from"./el-avatar-_8QHTF_R.js";import{E as q}from"./el-rate-CxgiWAT4.js";/* empty css               *//* empty css                  */import{u as H,b as j,r as _,p as G,q as O,Y as P,l as m,Z as W,d as i,e as d,f as t,h as s,w as n,m as X,j as Y,t as f,G as b,g as Z,o as u,k as J,X as K,V as Q,W as ee,x as te}from"./index-Bd4-WGnv.js";import{u as se}from"./location-BLjXtEK9.js";import{g as oe,M as ne}from"./MapContainer-BJXWeWOR.js";import{E as ae}from"./index-DTydKQfe.js";import"./clamp-BcRwWhhj.js";import"./toNumber-BjADBi_g.js";import"./theme-DDUpnSH_.js";const le={class:"seeker-home"},ce={class:"home-header"},re={class:"addr-text"},ie={class:"map-section"},de={key:0,class:"responder-card-popup"},ue={class:"popup-content flex-between"},pe={class:"info-left"},_e={class:"name-row"},me={class:"name"},fe={class:"rating-row mt-1"},ve={key:0,class:"dist ml-2"},ge={key:1,class:"dist ml-2"},he={class:"action-panel"},ke={class:"category-grid"},be=["onClick"],ye={class:"icon-box"},we=["src"],Ce={class:"cat-name"},xe={class:"icon-box more"},Me={class:"publish-btn-wrapper"},Be={class:"btn-content"},Ee="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",Re="/images/responder-marker.svg",Ve={__name:"Home",setup(ze){const y=H(),a=se(),x=j(),w=_([]),M=_(null),C=_([]),l=_(null),B=G(()=>C.value.map(e=>({position:[e.lng||0,e.lat||0],title:e.nickname,icon:Re,rawData:e})));O(()=>{E(),v()});async function E(){try{const e=await P();e&&e.length>0&&(w.value=e.slice(0,3))}catch(e){console.error("获取类目失败",e)}}async function v(){try{const e=await oe();a.updateLocation(e.lat,e.lng,e.address),m.success("定位已更新"),g(e.lat,e.lng)}catch(e){console.error(e),a.latitude&&a.longitude?(m.warning("定位失败，使用上次位置"),g(a.latitude,a.longitude)):(m.warning("无法获取位置，已显示所有响应方"),a.updateLocation(39.9042,116.4074,"位置未知"),g(null,null))}}async function g(e,o){try{const p=await W(e,o);C.value=p||[]}catch(p){console.error("获取响应方数据失败",p)}}function R(e){e&&e.rawData&&(l.value=e.rawData)}function V(){te.confirm("确定要退出当前账号吗？","退出登录",{confirmButtonText:"退出",cancelButtonText:"取消",type:"warning"}).then(()=>{x.logout(),y.push("/login"),m.success("已退出登录")}).catch(()=>{})}function h(e){const o=e?{categoryId:e}:{};y.push({path:"/seeker/create-order",query:o})}return(e,o)=>{const p=i("SwitchButton"),r=X,k=Y,z=i("LocationInformation"),I=i("Bell"),L=i("Aim"),S=ae,N=q,T=A,D=i("Close"),F=i("MoreFilled"),U=i("Microphone");return u(),d("div",le,[t("div",ce,[s(k,{link:"",class:"header-icon-btn",onClick:V},{default:n(()=>[s(r,{size:20},{default:n(()=>[s(p)]),_:1})]),_:1}),t("div",{class:"location-bar text-ellipsis",onClick:v},[s(r,{class:"icon-loc"},{default:n(()=>[s(z)]),_:1}),t("span",re,f(b(a).address||"正在定位..."),1)]),s(k,{link:"",class:"header-icon-btn"},{default:n(()=>[s(r,{size:20},{default:n(()=>[s(I)]),_:1})]),_:1})]),t("div",ie,[s(ne,{ref_key:"mapRef",ref:M,height:"100%",clickable:"",center:[b(a).longitude,b(a).latitude],markers:B.value,onMarkerClick:R},null,8,["center","markers"]),t("div",{class:"relocate-btn",onClick:v},[s(r,null,{default:n(()=>[s(L)]),_:1})]),s(K,{name:"slide-up"},{default:n(()=>[l.value?(u(),d("div",de,[t("div",ue,[t("div",pe,[t("div",_e,[t("span",me,f(l.value.nickname||"未名响应方"),1),s(S,{size:"small",type:"success",effect:"dark",class:"ml-2"},{default:n(()=>[...o[4]||(o[4]=[J("已认证",-1)])]),_:1})]),t("div",fe,[s(N,{modelValue:l.value.rating,"onUpdate:modelValue":o[0]||(o[0]=c=>l.value.rating=c),disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}",size:"small"},null,8,["modelValue"]),l.value.distance?(u(),d("span",ve," 距您 "+f((l.value.distance/1e3).toFixed(1))+" km ",1)):(u(),d("span",ge,"距离未知"))])]),s(T,{size:40,src:l.value.avatarUrl},null,8,["src"])]),t("div",{class:"close-btn",onClick:o[1]||(o[1]=c=>l.value=null)},[s(r,null,{default:n(()=>[s(D)]),_:1})])])):Z("",!0)]),_:1})]),t("div",he,[t("div",ke,[(u(!0),d(Q,null,ee(w.value,c=>(u(),d("div",{key:c.id,class:"cat-item",onClick:Ie=>h(c.id)},[t("div",ye,[t("img",{src:c.catIconUrl||Ee,alt:"icon"},null,8,we)]),t("span",Ce,f(c.catName),1)],8,be))),128)),t("div",{class:"cat-item",onClick:o[2]||(o[2]=c=>h())},[t("div",xe,[s(r,null,{default:n(()=>[s(F)]),_:1})]),o[5]||(o[5]=t("span",{class:"cat-name"},"更多",-1))])]),t("div",Me,[s(k,{type:"primary",size:"large",class:"publish-btn",round:"",onClick:o[3]||(o[3]=c=>h())},{default:n(()=>[t("span",Be,[s(r,{size:22,class:"mr-1"},{default:n(()=>[s(U)]),_:1}),o[6]||(o[6]=t("span",{class:"text"},"一键呼救 / 发布需求",-1))])]),_:1})])])])}}},Ge=$(Ve,[["__scopeId","data-v-912682ac"]]);export{Ge as default};
