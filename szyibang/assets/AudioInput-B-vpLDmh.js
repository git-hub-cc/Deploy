import{_ as je}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                  */import{r as We,e as Be,h as Ve,g as Je,a5 as Pe,j as He,o as Ge,l as _e}from"./index-Dczg_W-s.js";function Ke(q){return q&&q.__esModule&&Object.prototype.hasOwnProperty.call(q,"default")?q.default:q}var Ue={exports:{}};(function(q){(function(fe){var te=typeof window=="object"&&!!window.document,j=te?window:Object;fe(j,te),q.exports&&(q.exports=j.Recorder)})(function(fe,te){var j=function(){},V=function(r){return typeof r=="number"},H=function(r){return JSON.stringify(r)},s=function(r){return new Ee(r)},ne=s.LM="2025-01-11 09:28",Y="https://github.com/xiangyuecn/Recorder",L="Recorder",J="getUserMedia",ae="srcSampleRate",z="sampleRate",ie="bitRate",oe="catch",Z=fe[L];if(Z&&Z.LM==ne){Z.CLog(Z.i18n.$T("K8zP::重复导入{1}",0,L),3);return}s.IsOpen=function(){var r=s.Stream;if(r){var t=ye(r),e=t[0];if(e){var n=e.readyState;return n=="live"||n==e.LIVE}}return!1},s.BufferSize=4096,s.Destroy=function(){I(L+" Destroy"),Ce();for(var r in ee)ee[r]()};var ee={};s.BindDestroy=function(r,t){ee[r]=t},s.Support=function(){if(!te)return!1;var r=navigator.mediaDevices||{};return r[J]||(r=navigator,r[J]||(r[J]=r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia)),!(!r[J]||(s.Scope=r,!s.GetContext()))},s.GetContext=function(r){if(!te)return null;var t=window.AudioContext;if(t||(t=window.webkitAudioContext),!t)return null;var e=s.Ctx,n=0;return e||(e=s.Ctx=new t,n=1,s.NewCtxs=s.NewCtxs||[],s.BindDestroy("Ctx",function(){var a=s.Ctx;a&&a.close&&(re(a),s.Ctx=0);var o=s.NewCtxs;s.NewCtxs=[];for(var i=0;i<o.length;i++)re(o[i])})),r&&e.close&&(n||(e._useC||re(e),e=new t),e._useC=1,s.NewCtxs.push(e)),e},s.CloseNewCtx=function(r){if(r&&r.close){re(r);for(var t=s.NewCtxs||[],e=t.length,n=0;n<t.length;n++)if(t[n]==r){t.splice(n,1);break}I(f("mSxV::剩{1}个GetContext未close",0,e+"-1="+t.length),t.length?3:0)}};var re=function(r){if(r&&r.close&&!r._isC&&(r._isC=1,r.state!="closed"))try{r.close()}catch(t){I("ctx close err",1,t)}},ue=s.ResumeCtx=function(r,t,e,n){var a=0,o=0,i=0,d=0,u="EventListener",v="ResumeCtx ",w=function(C,l){o&&N(),a||(a=1,C&&n(C,d),l&&e(d)),l&&(!r._LsSC&&r["add"+u]&&r["add"+u]("statechange",p),r._LsSC=1,i=1)},N=function(C){if(!(C&&o)){o=C?1:0;for(var l=["focus","mousedown","mouseup","touchstart","touchend"],T=0;T<l.length;T++)window[(C?"add":"remove")+u](l[T],p,!0)}},p=function(){var C=r.state,l=Se(C);if(!a&&!t(l?++d:d))return w();l?(i&&I(v+"sc "+C,3),N(1),r.resume().then(function(){i&&I(v+"sc "+r.state),w(0,1)})[oe](function(T){I(v+"error",1,T),Se(r.state)||w(T.message||"error")})):C=="closed"?(i&&!r._isC&&I(v+"sc "+C,1),w("ctx closed")):w(0,1)};p()},Se=s.CtxSpEnd=function(r){return r=="suspended"||r=="interrupted"},Me=function(r){var t=r.state,e="ctx.state="+t;return Se(t)&&(e+=f("nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）")),e},be="ConnectEnableWebM";s[be]=!0;var me="ConnectEnableWorklet";s[me]=!1;var Te=function(r){var t=r.BufferSize||s.BufferSize,e=r.Stream,n=e._c,a=n[z],o={},i=ye(e),d=i[0],u=null,v="";if(d&&d.getSettings){u=d.getSettings();var w=u[z];w&&w!=a&&(v=f("eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，",0,w,a))}e._ts=u,I(v+"Stream TrackSet: "+H(u),v?3:0);var N=function(b){var M=e._m=n.createMediaStreamSource(e),A=n.destination,G="createMediaStreamDestination";n[G]&&(A=e._d=n[G]()),M.connect(b),b.connect(A)},p,C,l,T="",k=e._call,_=function(b,M){for(var A in k){if(M!=a){o.index=0,o=s.SampleData([b],M,a,o,{_sum:1});var G=o.data,W=o._sum}else{o={};for(var E=b.length,G=new Int16Array(E),W=0,$=0;$<E;$++){var B=Math.max(-1,Math.min(1,b[$]));B=B<0?B*32768:B*32767,G[$]=B,W+=Math.abs(B)}}for(var U in k)k[U](G,W);return}},h="ScriptProcessor",x="audioWorklet",S=L+" "+x,D="RecProc",y="MediaRecorder",F=y+".WebM.PCM",g=n.createScriptProcessor||n.createJavaScriptNode,m=f("ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。",0,x),c=function(){C=e.isWorklet=!1,Ie(e),I(f("7TU0::Connect采用老的{1}，",0,h)+Q.get(s[me]?f("JwCL::但已设置{1}尝试启用{2}",2):f("VGjB::可设置{1}尝试启用{2}",2),[L+"."+me+"=true",x])+T+m,3);var b=e._p=g.call(n,t,1,1);N(b),b.onaudioprocess=function(M){var A=M.inputBuffer.getChannelData(0);_(A,a)}},P=function(){p=e.isWebM=!1,ke(e),C=e.isWorklet=!g||s[me];var b=window.AudioWorkletNode;if(!(C&&n[x]&&b)){c();return}var M=function(){var $=function(U){return U.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,S)},B="class "+D+" extends AudioWorkletProcessor{";return B+="constructor "+$(function(U){DEL_super(U);var X=this,O=U.processorOptions.bufferSize;X.bufferSize=O,X.buffer=new Float32Array(O*2),X.pos=0,X.port.onmessage=function(K){K.data.kill&&(X.kill=!0,$C.log("$RA kill call"))},$C.log("$RA .ctor call",U)}),B+="process "+$(function(U,X,O){var K=this,de=K.bufferSize,ce=K.buffer,le=K.pos;if(U=(U[0]||[])[0]||[],U.length){ce.set(U,le),le+=U.length;var he=~~(le/de)*de;if(he){this.port.postMessage({val:ce.slice(0,he)});var we=ce.subarray(he,le);ce=new Float32Array(de*2),ce.set(we),le=we.length,K.buffer=ce}K.pos=le}return!K.kill}),B+='}try{registerProcessor("'+D+'", '+D+')}catch(e){$C.error("'+S+' Reg Error",e)}',B=B.replace(/\$C\./g,"console."),"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(B)))},A=function(){return C&&e._na},G=e._na=function(){l!==""&&(clearTimeout(l),l=setTimeout(function(){l=0,A()&&(I(f("MxX1::{1}未返回任何音频，恢复使用{2}",0,x,h),3),g&&c())},500))},W=function(){if(A()){var $=e._n=new b(n,D,{processorOptions:{bufferSize:t}});N($),$.port.onmessage=function(B){l&&(clearTimeout(l),l=""),A()?_(B.data.val,a):C||I(f("XUap::{1}多余回调",0,x),3)},I(f("yOta::Connect采用{1}，设置{2}可恢复老式{3}",0,x,L+"."+me+"=false",h)+T+m,3)}},E=function(){if(A()){if(n[D]){W();return}var $=M();n[x].addModule($).then(function(B){A()&&(n[D]=1,W(),l&&G())})[oe](function(B){I(x+".addModule Error",1,B),A()&&c()})}};ue(n,function(){return A()},E,E)},R=function(){var b=window[y],M="ondataavailable",A="audio/webm; codecs=pcm";p=e.isWebM=s[be];var G=b&&M in b.prototype&&b.isTypeSupported(A);if(T=G?"":f("VwPd::（此浏览器不支持{1}）",0,F),!p||!G){P();return}var W=function(){return p&&e._ra};e._ra=function(){l!==""&&(clearTimeout(l),l=setTimeout(function(){W()&&(I(f("vHnb::{1}未返回任何音频，降级使用{2}",0,y,x),3),P())},500))};var E=Object.assign({mimeType:A},s.ConnectWebMOptions),$=e._r=new b(e,E),B=e._rd={};$[M]=function(U){var X=new FileReader;X.onloadend=function(){if(W()){var O=$e(new Uint8Array(X.result),B);if(!O)return;if(O==-1){P();return}l&&(clearTimeout(l),l=""),_(O,B.webmSR)}else p||I(f("O9P7::{1}多余回调",0,y),3)},X.readAsArrayBuffer(U.data)};try{$.start(~~(t/48)),I(f("LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}",0,F,L+"."+be+"=false",x,h))}catch(U){I("mr start err",1,U),P()}};R()},Le=function(r){r._na&&r._na(),r._ra&&r._ra()},Ie=function(r){r._na=null,r._n&&(r._n.port.postMessage({kill:!0}),r._n.disconnect(),r._n=null)},ke=function(r){if(r._ra=null,r._r){try{r._r.stop()}catch(t){I("mr stop err",1,t)}r._r=null}},Ce=function(r){r=r||s;var t=r==s,e=r.Stream;e&&(e._m&&(e._m.disconnect(),e._m=null),!e._RC&&e._c&&s.CloseNewCtx(e._c),e._RC=null,e._c=null,e._d&&(Ae(e._d.stream),e._d=null),e._p&&(e._p.disconnect(),e._p.onaudioprocess=e._p=null),Ie(e),ke(e),t&&Ae(e)),r.Stream=0},Ae=s.StopS_=function(r){for(var t=ye(r),e=0;e<t.length;e++){var n=t[e];n.stop&&n.stop()}r.stop&&r.stop()},ye=function(r){var t=0,e=0,n=[];r.getAudioTracks&&(t=r.getAudioTracks(),e=r.getVideoTracks()),t||(t=r.audioTracks,e=r.videoTracks);for(var a=0,o=t?t.length:0;a<o;a++)n.push(t[a]);for(var a=0,o=e?e.length:0;a<o;a++)n.push(e[a]);return n};s.SampleData=function(r,t,e,n,a){var o="SampleData";n||(n={});var i=n.index||0,d=n.offset||0,u=n.raisePrev||0,v=n.filter;if(v&&v.fn&&(v.sr&&v.sr!=t||v.srn&&v.srn!=e)&&(v=null,I(f("d48C::{1}的filter采样率变了，重设滤波",0,o),3)),!v)if(e<=t){var w=e>t*3/4?0:e/2*3/4;v={fn:w?s.IIRFilter(!0,t,w):0}}else{var w=t>e*3/4?0:t/2*3/4;v={fn:w?s.IIRFilter(!0,e,w):0}}v.sr=t,v.srn=e;var N=v.fn,p=n.frameNext||[];a||(a={});var C=a.frameSize||1;a.frameType&&(C=a.frameType=="mp3"?1152:1);var l=a._sum,T=0,k=r.length;i>k+1&&I(f("tlbC::{1}似乎传入了未重置chunk {2}",0,o,i+">"+k),3);for(var _=0,h=i;h<k;h++)_+=r[h].length;var x=t/e;if(x>1)_=Math.max(0,_-Math.floor(d)),_=Math.floor(_/x);else if(x<1){var S=1/x;_=Math.floor(_*S)}_+=p.length;for(var D=new Int16Array(_),y=0,h=0;h<p.length;h++)D[y]=p[h],y++;for(;i<k;i++){var F=r[i],g=F instanceof Float32Array,h=d,m=F.length,c=N&&N.Embed,P=0,R=0,b=0,M=0;if(x<1){for(var A=y+h,G=u,W=0;W<m;W++){var E=F[W];g&&(E=Math.max(-1,Math.min(1,E)),E=E<0?E*32768:E*32767);var $=Math.floor(A);A+=S;for(var B=Math.floor(A),U=(E-G)/(B-$),X=1;$<B;$++,X++){var O=Math.floor(G+X*U);c?(b=O,M=c.b0*b+c.b1*c.x1+c.b0*c.x2-c.a1*c.y1-c.a2*c.y2,c.x2=c.x1,c.x1=b,c.y2=c.y1,c.y1=M,O=M):O=N?N(O):O,O>32767?O=32767:O<-32768&&(O=-32768),l&&(T+=Math.abs(O)),D[$]=O,y++}G=u=E,h+=S}d=h%1;continue}for(var W=0,K=0;W<m;W++,K++){if(K<m){var E=F[K];g&&(E=Math.max(-1,Math.min(1,E)),E=E<0?E*32768:E*32767),c?(b=E,M=c.b0*b+c.b1*c.x1+c.b0*c.x2-c.a1*c.y1-c.a2*c.y2,c.x2=c.x1,c.x1=b,c.y2=c.y1,c.y1=M):M=N?N(E):E}if(P=R,R=M,K==0){W--;continue}var de=Math.floor(h);if(W==de){var ce=Math.ceil(h),le=h-de,he=P,we=ce<m?R:he,pe=he+(we-he)*le;pe>32767?pe=32767:pe<-32768&&(pe=-32768),l&&(T+=Math.abs(pe)),D[y]=pe,y++,h+=x}}d=Math.max(0,h-m)}x<1&&y+1==_&&(_--,D=new Int16Array(D.buffer.slice(0,_*2))),y-1!=_&&y!=_&&I(o+" idx:"+y+" != size:"+_,3),p=null;var Oe=_%C;if(Oe>0){var Ne=(_-Oe)*2;p=new Int16Array(D.buffer.slice(Ne)),D=new Int16Array(D.buffer.slice(0,Ne))}var Re={index:i,offset:d,raisePrev:u,filter:v,frameNext:p,sampleRate:e,data:D};return l&&(Re._sum=T),Re},s.IIRFilter=function(r,t,e){var n=2*Math.PI*e/t,a=Math.sin(n),o=Math.cos(n),i=a/2,d=1+i,u=-2*o/d,v=(1-i)/d;if(r)var w=(1-o)/2/d,N=(1-o)/d;else var w=(1+o)/2/d,N=-(1+o)/d;var p=0,C=0,l=0,T=0,k=0,_=function(h){return l=w*h+N*p+w*C-u*T-v*k,C=p,p=h,k=T,T=l,l};return _.Embed={x1:0,x2:0,y1:0,y2:0,b0:w,b1:N,a1:u,a2:v},_},s.PowerLevel=function(r,t){var e=r/t||0,n;return e<1251?n=Math.round(e/1250*10):n=Math.round(Math.min(100,Math.max(0,(1+Math.log(e/1e4)/Math.log(10))*100))),n},s.PowerDBFS=function(r){var t=Math.max(.1,r||0),e=32767;return t=Math.min(t,e),t=20*Math.log(t/e)/Math.log(10),Math.max(-100,Math.round(t))},s.CLog=function(r,t){if(typeof console=="object"){var e=new Date,n=("0"+e.getMinutes()).substr(-2)+":"+("0"+e.getSeconds()).substr(-2)+"."+("00"+e.getMilliseconds()).substr(-3),a=this&&this.envIn&&this.envCheck&&this.id,o=["["+n+" "+L+(a?":"+a:"")+"]"+r],i=arguments,d=s.CLog,u=2,v=d.log||console.log;for(V(t)?v=t==1?d.error||console.error:t==3?d.warn||console.warn:v:u=1;u<i.length;u++)o.push(i[u]);ze?v&&v("[IsLoser]"+o[0],o.length>1?o:""):v.apply(console,o)}};var I=function(){s.CLog.apply(this,arguments)},ze=!0;try{ze=!console.log.apply}catch{}var Fe=0;function Ee(r){var t=this;t.id=++Fe,De();var e={type:"mp3",onProcess:j};for(var n in r)e[n]=r[n];t.set=e;var a=e[ie],o=e[z];(a&&!V(a)||o&&!V(o))&&t.CLog(f.G("IllegalArgs-1",[f("VtS4::{1}和{2}必须是数值",0,z,ie)]),1,r),e[ie]=+a||16,e[z]=+o||16e3,t.state=0,t._S=9,t.Sync={O:9,C:9}}s.Sync={O:9,C:9},s.prototype=Ee.prototype={CLog:I,_streamStore:function(){return this.set.sourceStream?this:s},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var r=this._streamGet();return r&&r._c},open:function(r,t){var e=this,n=e.set,a=e._streamStore(),o=0;r=r||j;var i=function(g,m){m=!!m,e.CLog(f("5tWi::录音open失败：")+g+",isUserNotAllow:"+m,1),o&&s.CloseNewCtx(o),t&&t(g,m)};e._streamTag=J;var d=function(){e.CLog("open ok, id:"+e.id+" stream:"+e._streamTag),r(),e._SO=0},u=a.Sync,v=++u.O,w=u.C;e._O=e._O_=v,e._SO=e._S;var N=function(){if(w!=u.C||!e._O){var g=f("dFm8::open被取消");return v==u.O?e.close():g=f("VtJO::open被中断"),i(g),!0}};if(!te){i(f.G("NonBrowser-1",["open"])+f("EMJq::，可尝试使用RecordApp解决方案")+"("+Y+"/tree/master/app-support-sample)");return}var p=e.envCheck({envName:"H5",canProcess:!0});if(p){i(f("A5bm::不能录音：")+p);return}var C,l=function(){C=n.runningContext,C||(C=o=s.GetContext(!0))};if(n.sourceStream){if(e._streamTag="set.sourceStream",!s.GetContext()){i(f("1iU7::不支持此浏览器从流中获取录音"));return}l(),Ce(a);var T=e.Stream=n.sourceStream;T._c=C,T._RC=n.runningContext,T._call={};try{Te(a)}catch(g){Ce(a),i(f("BTW2::从流中打开录音失败：")+g.message);return}d();return}var k=function(g,m){try{window.top.a}catch{i(f("Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})",0,'allow="camera;microphone"'));return}_(1,g)&&(/Found/i.test(g)?i(m+f("jBa9::，无可用麦克风")):i(m))},_=function(g,m){if(/Permission|Allow/i.test(m))g&&i(f("gyO5::用户拒绝了录音权限"),!0);else if(window.isSecureContext===!1)g&&i(f("oWNo::浏览器禁止不安全页面录音，可开启https解决"));else return 1};if(s.IsOpen()){d();return}if(!s.Support()){k("",f("COxc::此浏览器不支持录音"));return}l();var h=function(g){setTimeout(function(){g._call={};var m=s.Stream;m&&(Ce(),g._call=m._call),s.Stream=g,g._c=C,g._RC=n.runningContext,!N()&&(s.IsOpen()?(m&&e.CLog(f("upb8::发现同时多次调用open"),1),Te(a),d()):i(f("Q1GA::录音功能无效：无音频流")))},100)},x=function(g){var m=g.name||g.message||g.code+":"+g,c="";S==1&&_(0,m)&&(c=f("KxE2::，将尝试禁用回声消除后重试"));var P=f("xEQR::请求录音权限错误"),R=f("bDOG::无法录音：");e.CLog(P+c+"|"+g,c||y?3:1,g),c?(D=m,y=g,F(1)):y?(e.CLog(P+"|"+y,1,y),k(D,R+y)):k(m,R+g)},S=0,D,y,F=function(g){S++;var m="audioTrackSet",c="autoGainControl",P="echoCancellation",R="noiseSuppression",b=m+":{"+P+","+R+","+c+"}",M=JSON.parse(H(n[m]||!0));e.CLog("open... "+S+" "+m+":"+H(M)),g&&(typeof M!="object"&&(M={}),M[c]=!1,M[P]=!1,M[R]=!1),M[z]&&e.CLog(f("IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象",0,m+"."+z),3);var A={audio:M,video:n.videoTrackSet||!1};try{var G=s.Scope[J](A,h,x)}catch(W){e.CLog(J,3,W),A={audio:!0,video:!1},G=s.Scope[J](A,h,x)}e.CLog(J+"("+H(A)+") "+Me(C)+f("RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置",0,b,m)+"("+Y+") LM:"+ne+" UA:"+navigator.userAgent),G&&G.then&&G.then(h)[oe](x)};F()},close:function(r){r=r||j;var t=this,e=t._streamStore();t._stop();var n=" stream:"+t._streamTag,a=e.Sync;if(t._O=0,t._O_!=a.O){t.CLog(f("hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）")+n,3),r();return}a.C++,Ce(e),t.CLog("close,"+n),r()},mock:function(r,t){var e=this;return e._stop(),e.isMock=1,e.mockEnvInfo=null,e.buffers=[r],e.recSize=r.length,e._setSrcSR(t),e._streamTag="mock",e},_setSrcSR:function(r){var t=this,e=t.set,n=e[z];n>r?e[z]=r:n=0,t[ae]=r,t.CLog(ae+": "+r+" set."+z+": "+e[z]+(n?" "+f("UHvm::忽略")+": "+n:""),n?3:0)},envCheck:function(r){var t,e=this,n=e.set,a="CPU_BE";if(!t&&!s[a]&&typeof Int8Array=="function"&&!new Int8Array(new Int32Array([1]).buffer)[0]&&(De(a),t=f("Essp::不支持{1}架构",0,a)),!t){var o=n.type,i=e[o+"_envCheck"];n.takeoffEncodeChunk&&(i?r.canProcess||(t=f("7uMV::{1}环境不支持实时处理",0,r.envName)):t=f("2XBl::{1}类型不支持设置takeoffEncodeChunk",0,o)+(e[o]?"":f("LG7e::(未加载编码器)"))),!t&&i&&(t=e[o+"_envCheck"](r,n))}return t||""},envStart:function(r,t){var e=this,n=e.set;if(e.isMock=r?1:0,e.mockEnvInfo=r,e.buffers=[],e.recSize=0,r&&(e._streamTag="env$"+r.envName),e.state=1,e.envInLast=0,e.envInFirst=0,e.envInFix=0,e.envInFixTs=[],e._setSrcSR(t),e.engineCtx=0,e[n.type+"_start"]){var a=e.engineCtx=e[n.type+"_start"](n);a&&(a.pcmDatas=[],a.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(r,t){var e=this,n=e.set,a=e.engineCtx;if(e.state!=1){e.state||e.CLog("envIn at state=0",3);return}var o=e[ae],i=r.length,d=s.PowerLevel(t,i),u=e.buffers,v=u.length;u.push(r);var w=u,N=v,p=Date.now(),C=Math.round(i/o*1e3);e.envInLast=p,e.buffers.length==1&&(e.envInFirst=p-C);var l=e.envInFixTs;l.splice(0,0,{t:p,d:C});for(var T=p,k=0,_=0;_<l.length;_++){var h=l[_];if(p-h.t>3e3){l.length=_;break}T=h.t,k+=h.d}var x=l[1],S=p-T,D=S-k;if(D>S/3&&(x&&S>1e3||l.length>=6)){var y=p-x.t-C;if(y>C/5){var F=!n.disableEnvInFix;if(e.CLog("["+p+"]"+Q.get(f(F?"4Kfd::补偿{1}ms":"bM5i::未补偿{1}ms",1),[y]),3),e.envInFix+=y,F){var g=new Int16Array(y*o/1e3);i+=g.length,u.push(g)}}}var m=e.recSize,c=i,P=m+c;if(e.recSize=P,a){var R=s.SampleData(u,o,n[z],a.chunkInfo);a.chunkInfo=R,m=a.pcmSize,c=R.data.length,P=m+c,a.pcmSize=P,u=a.pcmDatas,v=u.length,u.push(R.data),o=R[z]}var b=Math.round(P/o*1e3),M=u.length,A=w.length,G=function(){for(var U=W?0:-c,X=u[0]==null,O=v;O<M;O++){var K=u[O];K==null?X=1:(U+=K.length,a&&K.length&&e[n.type+"_encode"](a,K))}if(X&&a){var O=N;for(w[0]&&(O=0);O<A;O++)w[O]=null}X&&(U=W?c:0,u[0]=null),a?a.pcmSize+=U:e.recSize+=U},W=0,E="rec.set.onProcess";try{W=n.onProcess(u,d,b,o,v,G),W=W===!0}catch(U){console.error(E+f("gFUF::回调出错是不允许的，需保证不会抛异常"),U)}var $=Date.now()-p;if($>10&&e.envInFirst-p>1e3&&e.CLog(E+f("2ghS::低性能，耗时{1}ms",0,$),3),W){for(var B=0,_=v;_<M;_++)u[_]==null?B=1:u[_]=new Int16Array(0);B?e.CLog(f("ufqH::未进入异步前不能清除buffers"),3):a?a.pcmSize-=c:e.recSize-=c}else G()},start:function(){var r=this,t=1;if(r.set.sourceStream?r.Stream||(t=0):s.IsOpen()||(t=0),!t){r.CLog(f("6WmN::start失败：未open"),1);return}var e=r._streamCtx();if(r.CLog(f("kLDN::start 开始录音，")+Me(e)+" stream:"+r._streamTag),r._stop(),r.envStart(null,e[z]),r.state=3,r._SO&&r._SO+1!=r._S){r.CLog(f("Bp2y::start被中断"),3);return}r._SO=0;var n=function(){r.state==3&&(r.state=1,r.resume())},a="AudioContext resume: ",o=r._streamGet();o._call[r.id]=function(){r.CLog(a+e.state+"|stream ok"),n()},ue(e,function(i){return i&&r.CLog(a+"wait..."),r.state==3},function(i){i&&r.CLog(a+e.state),n()},function(i){r.CLog(a+e.state+f("upkE::，可能无法录音：")+i,1),n()})},pause:function(){var r=this,t=r._streamGet();r.state&&(r.state=2,r.CLog("pause"),t&&delete t._call[r.id])},resume:function(){var r=this,t=r._streamGet(),e="resume",n=e+"(wait ctx)";if(r.state==3)r.CLog(n);else if(r.state){r.state=1,r.CLog(e),r.envResume(),t&&(t._call[r.id]=function(o,i){r.state==1&&r.envIn(o,i)},Le(t));var a=r._streamCtx();a&&ue(a,function(o){return o&&r.CLog(n+"..."),r.state==1},function(o){o&&r.CLog(n+a.state),Le(t)},function(o){r.CLog(n+a.state+"[err]"+o,1)})}},_stop:function(r){var t=this,e=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!r&&t[e.type+"_stop"]&&(t[e.type+"_stop"](t.engineCtx),t.engineCtx=0)},stop:function(r,t,e){var n=this,a=n.set,o,i=n.envInLast-n.envInFirst,d=i&&n.buffers.length;n.CLog(f("Xq4s::stop 和start时差:")+(i?i+"ms "+f("3CQP::补偿:")+n.envInFix+"ms envIn:"+d+" fps:"+(d/i*1e3).toFixed(1):"-")+" stream:"+n._streamTag+" ("+Y+") LM:"+ne);var u=function(){n._stop(),e&&n.close()},v=function(h){n.CLog(f("u8JG::结束录音失败：")+h,1),t&&t(h),u()},w=function(h,x,S){var D="blob",y="arraybuffer",F="dataType",g="DefaultDataType",m=n[F]||s[g]||D,c=F+"="+m,P=h instanceof ArrayBuffer,R=0,b=P?h.byteLength:h.size;if(m==y?P||(R=1):m==D?typeof Blob!="function"?R=f.G("NonBrowser-1",[c])+f("1skY::，请设置{1}",0,L+"."+g+'="'+y+'"'):(P&&(h=new Blob([h],{type:x})),h instanceof Blob||(R=1),x=h.type||x):R=f.G("NotSupport-1",[c]),n.CLog(f("Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b",0,Date.now()-o,S,b)+" "+c+","+x),R){v(R!=1?R:f("Vkbd::{1}编码器返回的不是{2}",0,a.type,m)+", "+c);return}if(a.takeoffEncodeChunk)n.CLog(f("QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据"),3);else if(b<Math.max(50,S/5)){v(f("Sz2H::生成的{1}无效",0,a.type));return}r&&r(h,S,x),u()};if(!n.isMock){var N=n.state==3;if(!n.state||N){v(f("wf9t::未开始录音")+(N?f("Dl2c::，开始录音前无用户交互导致AudioContext未运行"):""));return}}n._stop(!0);var p=n.recSize;if(!p){v(f("Ltz3::未采集到录音"));return}if(!n[a.type]){v(f("xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载",0,a.type,L));return}if(n.isMock){var C=n.envCheck(n.mockEnvInfo||{envName:"mock",canProcess:!1});if(C){v(f("AxOH::录音错误：")+C);return}}var l=n.engineCtx;if(n[a.type+"_complete"]&&l){var _=Math.round(l.pcmSize/a[z]*1e3);o=Date.now(),n[a.type+"_complete"](l,function(x,S){w(x,S,_)},v);return}if(o=Date.now(),!n.buffers[0]){v(f("xkKd::音频buffers被释放"));return}var T=s.SampleData(n.buffers,n[ae],a[z]);a[z]=T[z];var k=T.data,_=Math.round(k.length/a[z]*1e3);n.CLog(f("CxeT::采样:{1} 花:{2}ms",0,p+"->"+k.length,Date.now()-o)),setTimeout(function(){o=Date.now(),n[a.type](k,function(h,x){w(h,x,_)},function(h){v(h)})})}};var $e=function(r,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var e=t.tracks,n=[t.pos[0]],a=function(){t.pos[0]=n[0]},o=t.bytes.length,i=new Uint8Array(o+r.length);if(i.set(t.bytes),i.set(r,o),t.bytes=i,!t._ht){if(ve(i,n),ge(i,n),!se(ve(i,n),[24,83,128,103]))return;for(ve(i,n);n[0]<i.length;){var d=ve(i,n),u=ge(i,n),v=[0],w=0;if(!u)return;if(se(d,[22,84,174,107])){for(;v[0]<u.length;){var N=ve(u,v),p=ge(u,v),C=[0],l={channels:0,sampleRate:0};if(se(N,[174]))for(;C[0]<p.length;){var T=ve(p,C),k=ge(p,C),_=[0];if(se(T,[215])){var h=xe(k);l.number=h,e[h]=l}else if(se(T,[131])){var h=xe(k);h==1?l.type="video":h==2?(l.type="audio",w||(t.track0=l),l.idx=w++):l.type="Type-"+h}else if(se(T,[134])){for(var x="",S=0;S<k.length;S++)x+=String.fromCharCode(k[S]);l.codec=x}else if(se(T,[225]))for(;_[0]<k.length;){var D=ve(k,_),y=ge(k,_);if(se(D,[181])){var h=0,F=new Uint8Array(y.reverse()).buffer;y.length==4?h=new Float32Array(F)[0]:y.length==8?h=new Float64Array(F)[0]:I("WebM Track !Float",1,y),l[z]=Math.round(h)}else se(D,[98,100])?l.bitDepth=xe(y):se(D,[159])&&(l.channels=xe(y))}}}t._ht=1,I("WebM Tracks",e),a();break}}}var g=t.track0;if(g){var m=g[z];if(t.webmSR=m,g.bitDepth==16&&/FLOAT/i.test(g.codec)&&(g.bitDepth=32,I("WebM 16->32 bit",3)),m<8e3||g.bitDepth!=32||g.channels<1||!/(\b|_)PCM\b/i.test(g.codec))return t.bytes=[],t.bad||I("WebM Track Unexpected",3,t),t.bad=1,-1;for(var c=[],P=0;n[0]<i.length;){var N=ve(i,n),p=ge(i,n);if(!p)break;if(se(N,[163])){var R=p[0]&15,l=e[R];if(l){if(l.idx===0){for(var b=new Uint8Array(p.length-4),S=4;S<p.length;S++)b[S-4]=p[S];c.push(b),P+=b.length}}else return I("WebM !Track"+R,1,e),-1}a()}if(P){var M=new Uint8Array(i.length-t.pos[0]);M.set(i.subarray(t.pos[0])),t.bytes=M,t.pos[0]=0;for(var b=new Uint8Array(P),S=0,A=0;S<c.length;S++)b.set(c[S],A),A+=c[S].length;var F=new Float32Array(b.buffer);if(g.channels>1){for(var G=[],S=0;S<F.length;)G.push(F[S]),S+=g.channels;F=new Float32Array(G)}return F}}},se=function(r,t){if(!r||r.length!=t.length)return!1;if(r.length==1)return r[0]==t[0];for(var e=0;e<r.length;e++)if(r[e]!=t[e])return!1;return!0},xe=function(r){for(var t="",e=0;e<r.length;e++){var n=r[e];t+=(n<16?"0":"")+n.toString(16)}return parseInt(t,16)||0},ve=function(r,t,e){var n=t[0];if(!(n>=r.length)){var a=r[n],o=("0000000"+a.toString(2)).substr(-8),i=/^(0*1)(\d*)$/.exec(o);if(i){var d=i[1].length,u=[];if(!(n+d>r.length)){for(var v=0;v<d;v++)u[v]=r[n],n++;return e&&(u[0]=parseInt(i[2]||"0",2)),t[0]=n,u}}}},ge=function(r,t){var e=ve(r,t,1);if(e){var n=xe(e),a=t[0],o=[];if(n<2147483647){if(a+n>r.length)return;for(var i=0;i<n;i++)o[i]=r[a],a++}return t[0]=a,o}},Q=s.i18n={lang:"zh-CN",alias:{"zh-CN":"zh","en-US":"en"},locales:{},data:{},put:function(r,t){var e=L+".i18n.put: ",n=r.overwrite;n=n==null||n;var a=r.lang;if(a=Q.alias[a]||a,!a)throw new Error(e+"set.lang?");var o=Q.locales[a];o||(o={},Q.locales[a]=o);for(var i=/^([\w\-]+):/,d,u=0;u<t.length;u++){var w=t[u];if(d=i.exec(w),!d){I(e+"'key:'? "+w,3,r);continue}var v=d[1],w=w.substr(v.length+1);!n&&o[v]||(o[v]=w)}},get:function(){return Q.v_G.apply(null,arguments)},v_G:function(r,t,e){t=t||[],e=e||Q.lang,e=Q.alias[e]||e;var n=Q.locales[e],a=n&&n[r]||"";return!a&&e!="zh"?e=="en"?Q.v_G(r,t,"zh"):Q.v_G(r,t,"en"):(Q.lastLang=e,a=="=Empty"?"":a.replace(/\{(\d+)(\!?)\}/g,function(o,i,d){return i=+i||0,o=t[i-1],(i<1||i>t.length)&&(o="{?}",I("i18n["+r+"] no {"+i+"}: "+a,3)),d?"":o}))},$T:function(){return Q.v_T.apply(null,arguments)},v_T:function(){for(var r=arguments,t="",e=[],n=0,a=L+".i18n.$T:",o=/^([\w\-]*):/,i,d=0;d<r.length;d++){var u=r[d];if(d==0){if(i=o.exec(u),t=i&&i[1],!t)throw new Error(a+"0 'key:'?");u=u.substr(t.length+1)}if(n===-1)e.push(u);else{if(n)throw new Error(a+" bad args");if(u===0)n=-1;else if(V(u)){if(u<1)throw new Error(a+" bad args");n=u}else{var v=d==1?"en":d?"":"zh";if(i=o.exec(u),i&&(v=i[1]||v,u=u.substr(i[1].length+1)),!i||!v)throw new Error(a+d+" 'lang:'?");Q.put({lang:v,overwrite:!1},[t+":"+u])}}}return t?n>0?t:Q.v_G(t,e):""}},f=Q.$T;f.G=Q.get,f("NonBrowser-1::非浏览器环境，不支持{1}",1),f("IllegalArgs-1::参数错误：{1}",1),f("NeedImport-2::调用{1}需要先导入{2}",2),f("NotSupport-1::不支持：{1}",1),s.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var De=s.Traffic=function(r){if(te){r=r?"/"+L+"/Report/"+r:"";var t=s.TrafficImgUrl;if(t){var e=s.Traffic,n=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],a=n[1]||"http://file/",o=(n[0]||a)+r;if(t.indexOf("//")==0&&(/^https:/i.test(o)?t="https:"+t:t="http:"+t),r&&(t=t+"&cu="+encodeURIComponent(a+r)),!e[o]){e[o]=1;var i=new Image;i.src=t,I("Traffic Analysis Image: "+(r||L+".TrafficImgUrl="+s.TrafficImgUrl))}}}};Z&&(I(f("8HO5::覆盖导入{1}",0,L),1),Z.Destroy()),fe[L]=s})})(Ue);var qe=Ue.exports;const Qe=Ke(qe);(function(q){var fe=typeof window=="object"&&!!window.document,te=fe?window:Object,j=te.Recorder,V=j.i18n;q(j,V,V.$T,fe)})(function(q,fe,te,j){q.prototype.enc_wav={stable:!0,fast:!0,getTestMsg:function(){return te("gPSE::支持位数8位、16位（填在比特率里面），采样率取值无限制；此编码器仅在pcm数据前加了一个44字节的wav头，编码出来的16位wav文件去掉开头的44字节即可得到pcm（注：其他wav编码器可能不是44字节）")}};var V=function(H){var s=H.bitRate,ne=s==8?8:16;s!=ne&&q.CLog(te("wyw9::WAV Info: 不支持{1}位，已更新成{2}位",0,s,ne),3),H.bitRate=ne};q.prototype.wav=function(H,s,ne){var Y=this,L=Y.set;V(L);var J=H.length,ae=L.sampleRate,z=L.bitRate,ie=J*(z/8),oe=q.wav_header(1,1,ae,z,ie),Z=oe.length,ee=new Uint8Array(Z+ie);if(ee.set(oe),z==8)for(var re=0;re<J;re++){var ue=(H[re]>>8)+128;ee[Z++]=ue}else ee=new Int16Array(ee.buffer),ee.set(H,Z/2);s(ee.buffer,"audio/wav")},q.wav_header=function(H,s,ne,Y,L){var J=H==1?0:2,ae=new ArrayBuffer(44+J),z=new DataView(ae),ie=0,oe=function(re){for(var ue=0;ue<re.length;ue++,ie++)z.setUint8(ie,re.charCodeAt(ue))},Z=function(re){z.setUint16(ie,re,!0),ie+=2},ee=function(re){z.setUint32(ie,re,!0),ie+=4};return oe("RIFF"),ee(36+J+L),oe("WAVE"),oe("fmt "),ee(16+J),Z(H),Z(s),ee(ne),ee(ne*(s*Y/8)),Z(s*Y/8),Z(Y),H!=1&&Z(0),oe("data"),ee(L),new Uint8Array(ae)}});const Xe={class:"audio-input-wrapper"},Ye={key:0,class:"recording-tip"},Ze={__name:"AudioInput",emits:["finish"],setup(q,{emit:fe}){const te=fe,j=We(!1),V=We(null);function H(){j.value||(V.value=Qe({type:"wav",sampleRate:16e3,bitRate:16}),V.value.open(()=>{V.value&&(V.value.start(),j.value=!0,_e.info({message:"开始录音...",duration:1e3}))},L=>{console.error("无法获取麦克风权限或打开设备失败",L),_e.error("无法访问麦克风，请检查浏览器权限设置"),Y()}))}function s(){!V.value||!j.value||(j.value=!1,V.value.stop((L,J)=>{if(J<500){_e.warning("录音时间太短"),Y();return}if(!L||L.size===0){_e.error("录音失败，未能生成有效文件"),Y();return}const ae=new File([L],`voice_${Date.now()}.wav`,{type:"audio/wav"});te("finish",ae),Y()},L=>{console.error("录音失败",L),_e.error("录音过程中发生错误"),Y()}))}function ne(){j.value&&(console.warn("鼠标移出，取消录音"),_e.warning("已取消录音"),Y())}function Y(){V.value&&(V.value.close(),V.value=null),j.value=!1}return(L,J)=>{const ae=He;return Ge(),Be("div",Xe,[Ve(ae,{class:"record-btn",type:j.value?"danger":"primary",icon:(j.value,"Microphone"),circle:"",size:"large",onMousedown:H,onMouseup:s,onTouchstart:Pe(H,["prevent"]),onTouchend:Pe(s,["prevent"]),onMouseleave:ne},null,8,["type","icon"]),j.value?(Ge(),Be("div",Ye,"松开结束")):Je("",!0)])}}},nr=je(Ze,[["__scopeId","data-v-90e9d1cd"]]);export{nr as A};
