import{_ as W}from"./_plugin-vue_export-helper-DRcqrMy4.js";import{v as j}from"./el-loading-CDKhOZ5N.js";import{E as q}from"./el-drawer-C4lPBeEf.js";import"./el-overlay-BgBDSbqt.js";import{E as G}from"./el-rate-CxgiWAT4.js";/* empty css                  *//* empty css               */import{E as A}from"./el-empty-DFB2bBLd.js";import{E as J,a as K}from"./el-tab-pane-DzKcNUtr.js";import{u as Q,r as p,p as X,q as Y,d as Z,e as l,h as n,U as ss,w as i,O as d,g as m,V as ts,W as es,a4 as as,a2 as T,o,H as os,f as a,t as c,k as r,G as C,a5 as ns,m as ls,j as is,x as us,l as M}from"./index-Bd4-WGnv.js";import{b as cs,u as ps}from"./responder-CQoJMBgX.js";import{a as $,f as ds}from"./format-68UbSpw-.js";import{C as ms}from"./ChatWindow-vRD-qPwo.js";import{E as rs}from"./index-DTydKQfe.js";import"./index-C585l_VU.js";import"./clamp-BcRwWhhj.js";import"./toNumber-BjADBi_g.js";import"./raf-DB0AmFco.js";import"./strings-C9Hk7sRF.js";import"./index-Gk_XwiDR.js";import"./omit-rEkUoBp5.js";import"./_baseClone-DsOkhf4F.js";import"./el-progress-xYuBwGGD.js";/* empty css                 */import"./el-image-viewer-Cfn1FMc4.js";import"./debounce-rf4AVrH1.js";import"./el-avatar-_8QHTF_R.js";import"./AudioInput-UdpFeN70.js";const _s={class:"my-tasks-page mobile-view-wrapper"},vs={class:"task-list"},fs={class:"card-header flex-between"},gs={class:"sn"},ys=["onClick"],ks={class:"row"},hs={class:"value"},ws={class:"row"},Cs={class:"value"},bs={class:"row"},xs={class:"value address-text"},Es={class:"row"},Vs={class:"value"},Ts={key:0,class:"card-actions"},Ms={key:1,class:"card-actions end-column"},$s={class:"flex-between w-100"},Ds={class:"income"},Ss={key:0,class:"rating-row mt-2"},Is={key:1,class:"text-gray text-xs"},Ns={__name:"MyTasks",setup(zs){const D=Q(),g=p("ongoing"),y=p(!1),k=p([]),h=p(!1),_=p(null),w=p([]),b=X(()=>g.value==="ongoing"?k.value.filter(e=>e.status>=30&&e.status<50):k.value.filter(e=>e.status>=50||e.status===60));Y(()=>{x()});async function x(){y.value=!0;try{k.value=await cs()}finally{y.value=!1}}function E(e,t){let v=t===40?"确认已到达现场并开始服务？":"确认服务已全部完成？";us.confirm(v,"状态更新",{type:"info"}).then(async()=>{await ps(e,t),M.success("状态已更新"),x()})}function S(e){E(e,50)}function I(e){const t=`https://uri.amap.com/marker?position=${e.lng},${e.lat}&name=${e.addressName}`;window.open(t,"_blank")}async function N(e){_.value=e,w.value=await T(e.id),h.value=!0}async function z(e){await as({receiverId:_.value.seekerId,orderId:_.value.id,...e}),w.value=await T(_.value.id)}function Bs(e){}function B(e){e.caseId?D.push(`/dispute/detail/${e.caseId}`):M.info("请前往收益中心或消息通知查看纠纷详情")}return(e,t)=>{const v=J,U=K,O=A,V=rs,L=Z("Position"),P=ls,f=is,R=G,F=q,H=j;return o(),l("div",_s,[n(U,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),class:"custom-tabs",stretch:""},{default:i(()=>[n(v,{label:"进行中",name:"ongoing"}),n(v,{label:"已完成",name:"history"})]),_:1},8,["modelValue"]),ss((o(),l("div",vs,[b.value.length===0?(o(),d(O,{key:0,description:"暂无相关订单"})):m("",!0),(o(!0),l(ts,null,es(b.value,s=>(o(),l("div",{key:s.id,class:os(["task-card",{"has-dispute":s.hasDispute}])},[a("div",fs,[a("span",gs,"单号: "+c(s.orderSn.slice(-6)),1),a("div",null,[s.hasDispute?(o(),d(V,{key:0,type:"danger",effect:"dark",size:"small",class:"mr-2"},{default:i(()=>[...t[2]||(t[2]=[r("被追责",-1)])]),_:1})):m("",!0),n(V,{size:"small",type:C($)(s.status).type},{default:i(()=>[r(c(C($)(s.status).text),1)]),_:2},1032,["type"])])]),a("div",{class:"card-body",onClick:u=>(s.id,void 0)},[a("div",ks,[t[3]||(t[3]=a("span",{class:"label"},"类目:",-1)),a("span",hs,c(s.categoryName),1)]),a("div",ws,[t[4]||(t[4]=a("span",{class:"label"},"求助:",-1)),a("span",Cs,c(s.title),1)]),a("div",bs,[t[5]||(t[5]=a("span",{class:"label"},"地址:",-1)),a("span",xs,[r(c(s.addressName)+" ",1),n(P,{class:"nav-icon",onClick:ns(u=>I(s),["stop"])},{default:i(()=>[n(L)]),_:1},8,["onClick"])])]),a("div",Es,[t[6]||(t[6]=a("span",{class:"label"},"时间:",-1)),a("span",Vs,c(C(ds)(s.createTime)),1)])],8,ys),s.status<50&&s.status!==60?(o(),l("div",Ts,[n(f,{icon:"ChatDotRound",circle:"",onClick:u=>N(s)},null,8,["onClick"]),s.status===30?(o(),d(f,{key:0,type:"primary",plain:"",round:"",onClick:u=>E(s.orderSn,40)},{default:i(()=>[...t[7]||(t[7]=[r(" 确认到达 / 开始服务 ",-1)])]),_:1},8,["onClick"])):s.status===40?(o(),d(f,{key:1,type:"success",round:"",onClick:u=>S(s.orderSn)},{default:i(()=>[...t[8]||(t[8]=[r(" 完成服务 ",-1)])]),_:1},8,["onClick"])):m("",!0)])):s.status>=50?(o(),l("div",Ms,[a("div",$s,[a("span",Ds,"收益: ¥ "+c(s.responderIncome),1),s.hasDispute?(o(),d(f,{key:0,type:"danger",size:"small",plain:"",onClick:u=>B(s)},{default:i(()=>[...t[9]||(t[9]=[r(" 处理纠纷 ",-1)])]),_:1},8,["onClick"])):m("",!0)]),s.status===55?(o(),l("div",Ss,[t[10]||(t[10]=a("span",{class:"label text-gray text-xs mr-2"},"用户评分:",-1)),s.rating?(o(),d(R,{key:0,modelValue:s.rating,"onUpdate:modelValue":u=>s.rating=u,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}分",size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(o(),l("span",Is,"暂无评价"))])):m("",!0)])):m("",!0)],2))),128))])),[[H,y.value]]),n(F,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s),title:"联系求助方",direction:"btt",size:"80%"},{default:i(()=>[n(ms,{messages:w.value,onSend:z},null,8,["messages"])]),_:1},8,["modelValue"])])}}},pt=W(Ns,[["__scopeId","data-v-16a41574"]]);export{pt as default};
